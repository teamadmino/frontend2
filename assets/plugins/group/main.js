!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("adm.@angular/common"),require("adm.@angular/cdk"),require("adm.@angular/material"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):"function"==typeof define&&define.amd?define(["adm.@angular/common","adm.@angular/cdk","adm.@angular/material","adm.rxjs","adm.lodash","adm.rxjs/operators","adm.shared","adm.@angular/core"],e):"object"==typeof exports?exports.group=e(require("adm.@angular/common"),require("adm.@angular/cdk"),require("adm.@angular/material"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):t.group=e(t["adm.@angular/common"],t["adm.@angular/cdk"],t["adm.@angular/material"],t["adm.rxjs"],t["adm.lodash"],t["adm.rxjs/operators"],t["adm.shared"],t["adm.@angular/core"])}("undefined"!=typeof self?self:this,function(t,e,n,i,o,r,a,s){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,(function(e){return t[e]}).bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/assets/plugins/group",n(n.s=0)}({0:function(t,e,n){t.exports=n("P+m1")},"0S4P":function(e,n){e.exports=t},"8Yb7":function(t,n){t.exports=e},MdUB:function(t,e){t.exports=n},"P+m1":function(t,e,n){"use strict";n.r(e),n.d(e,"GroupModule",function(){return N});var i=n("0S4P"),o=n("vOrQ"),r=n("cfyg"),a=n("YLtl"),s=n("8Yb7"),l=n("aP7H"),p=n("Vgaj"),d=function(){function t(t){this.el=t,this.activeState={},this.nextState={},this.positionConfigDefaults={construction:"default",minW:void 0,minH:void 0,maxW:void 0,maxH:void 0,initW:void 0,initH:void 0,fillX:void 0,fillY:void 0,x:-1,y:-1,h:-1,w:-1,index:-1,hidden:!1,append:!1,newline:!1,eol:!1,alignRight:!1,alignCenter:!1,alignBottom:!1,alignMiddle:!1,lineAlignBottom:!1,lineAlignMiddle:!1,stickyAuto:!1,stickyFloat:!1,stickyBehind:!1,stickyParentSize:!1,selfSized:!1,parentSized:!1,clone:"",sticky:0,expansion:0,groupConfig:{innerPadding:0,elementsPadding:0,pageCenter:!1,pageMiddle:!1,justifiedGrid:!1},calculated:0,autoStickers:[],stickerHolder:void 0,sickerListeners:!1,layer:1,lastKnownSizeW:-1,lastKnownSizeH:-1},this.inited=!1,this.internalListeners={},this.eventListeners={},this.processedLayout={},this.prevProcessedLayout={},this.isDragging=!1,this.isMouseOver=!1,this.accessKeysChange$=new p.Subject,this.renderer=this.el.renderer}return t.prototype.listenEvent=function(t){var e=this;if(!this.eventListeners[t]){var n=this.renderer.listen(this.getWrapperDom(),t,function(n){e.layoutController.positionController.onElementEvent(e,t,n)});this.eventListeners[t]=n}},t.prototype.isListeningFor=function(t){return!!this.eventListeners[t]},t.prototype.init=function(t){var e=this;if(this.layoutController=t,this.layoutController.rootEl.el.wrapperComponentRef&&this.renderer.setStyle(this.getWrapperDom(),"position","absolute"),this.el.contentSizeChanged$.pipe(Object(l.takeUntil)(this.el.destroy$)).subscribe(function(t){e.layoutController.positionController.onElementSizeChanged(e,t)}),this.processLayoutConfig(),"group"===this.getType()){this.internalListeners.scroll=this.renderer.listen(this.el.pluginComponentRef.instance.wrapperEl.nativeElement,"scroll",function(t){e.layoutController.positionController.onGroupScroll(e)});var n=this.getChildren();n&&Object.keys(n).forEach(function(t){n[t].init(e.layoutController)})}this.inited=!0},t.prototype.update=function(t){if(this.inited||this.init(t),this.processLayoutConfig(),"group"===this.getType()){var e=this.getChildren();e&&Object.keys(e).forEach(function(n){e[n].update(t)})}},t.prototype.processLayoutBreakpoints=function(){var t=a.isNil(this.el.pluginConfig.layout)?{}:Object(a.cloneDeep)(this.el.pluginConfig.layout),e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),n=this.el.pluginConfig.layoutBreakpoints;if(n){var i=[];Object.keys(n).forEach(function(t){var o=t.substr(0,1),r=parseInt(t.substring(1,t.length),10),a=n[t];"<"===o?e<r&&i.unshift({layout:a,breakpoint:r,dir:-1}):e>r&&i.push({layout:a,breakpoint:r,dir:1})}),i.sort(function(t,e){return t.dir>e.dir?-1:t.dir<e.dir?1:(t.breakpoint>e.breakpoint?1:-1)*t.dir}),i.forEach(function(e){Object.assign(t,e.layout)})}return t},t.prototype.processLayoutConfig=function(){var t,e,n=this;this.processedLayout=this.processLayoutBreakpoints();var i=this.processedLayout,o=Object(r.deepCompare)(this.prevProcessedLayout,this.processedLayout).diff;o.draggable&&(this.clearListener("mouseOver"),this.clearListener("mouseDown"),i.draggable&&(this.internalListeners.mouseOver=this.renderer.listen(this.getWrapperDom(),"mouseover",function(t){n.isMouseOver=!0,t.stopPropagation(),n.layoutController.activeEl===n||n.layoutController.activeElementEngaged||n.layoutController.dragDisabled||n.layoutController.activate(n)}),this.internalListeners.mouseLeave=this.renderer.listen(this.getWrapperDom(),"mouseleave",function(t){n.isMouseOver=!1,n.handleMouseLeave()}),this.internalListeners.mouseclickOutside=this.renderer.listen(document,"click",function(t){var e;n.isDragging||n.isMouseOver||n.control&&(null===(e=n.control)||void 0===e?void 0:e.isMouseOver)||n.layoutController.deactivate(n)})),i.draggable&&(this.internalListeners.mouseDown=this.renderer.listen(this.getPluginDom(),"mousedown",function(t){n.layoutController.activeEl===n&&n.layoutController.controls.instance.dragStart(t)}))),o.dropzone&&(this.accessKeysChange$.next(),(null===(t=null==i?void 0:i.dropzone)||void 0===t?void 0:t.acceptKeys)&&(null===(e=null==i?void 0:i.dropzone)||void 0===e?void 0:e.showIndicator)?(this.renderer.addClass(this.getWrapperDom(),"adm-drop-zone"),this.layoutController.positionController.dragStart$.pipe(Object(l.takeUntil)(this.el.destroy$),Object(l.takeUntil)(this.accessKeysChange$)).subscribe(function(t){n.layoutController.positionController.canBeDropped(t.el,n)&&n.renderer.addClass(n.getWrapperDom(),"adm-drop-zone-active")}),this.layoutController.positionController.dragEnd$.pipe(Object(l.takeUntil)(this.el.destroy$),Object(l.takeUntil)(this.accessKeysChange$)).subscribe(function(t){n.renderer.removeClass(n.getWrapperDom(),"adm-drop-zone-active")})):this.renderer.removeClass(this.getWrapperDom(),"adm-drop-zone")),this.prevProcessedLayout=Object(a.cloneDeep)(this.processedLayout)},t.prototype.handleMouseLeave=function(){var t=this;clearTimeout(this.mouseLeaveTimeoutHelper),this.mouseLeaveTimeoutHelper=setTimeout(function(){var e;t.isDragging||t.isMouseOver||t.control&&(null===(e=t.control)||void 0===e?void 0:e.isMouseOver)||t.layoutController.activeElementEngaged||t.layoutController.deactivate(t)})},t.prototype.clearListener=function(t){this.internalListeners[t]&&(this.internalListeners[t](),delete this.internalListeners[t])},t.prototype.getParent=function(){var t,e,n,i;return null===(i=null===(n=null===(e=null===(t=this.el)||void 0===t?void 0:t.parentContext)||void 0===e?void 0:e.pluginComponentRef)||void 0===n?void 0:n.instance)||void 0===i?void 0:i.layoutElement},t.prototype.getDragElement=function(){var t,e;return(null===(e=null===(t=this.getLayout())||void 0===t?void 0:t.draggable)||void 0===e?void 0:e.parentDrag)?this.getParent():this},t.prototype.getRoot=function(){var t,e;return null===(e=null===(t=this.getParentContext())||void 0===t?void 0:t.rootContext.pluginComponentRef.instance)||void 0===e?void 0:e.layoutElement},t.prototype.getLayoutController=function(){var t,e;return null===(e=null===(t=this.getParentContext())||void 0===t?void 0:t.rootContext.pluginComponentRef.instance)||void 0===e?void 0:e.layoutController},t.prototype.applyMinMaxToNextStateNaturalSize=function(){this.nextState.naturalWidth<this.positionConfig.minW&&(this.nextState.naturalWidth=this.positionConfig.minW),this.nextState.naturalWidth>this.positionConfig.maxW&&-1!==this.positionConfig.maxW&&(this.nextState.naturalWidth=this.positionConfig.maxW),this.nextState.naturalHeight<this.positionConfig.minH&&(this.nextState.naturalHeight=this.positionConfig.minH),this.nextState.naturalHeight>this.positionConfig.maxH&&-1!==this.positionConfig.maxH&&(this.nextState.naturalHeight=this.positionConfig.maxH)},t.prototype.getScript=function(){var t;return a.isNil(this.processedLayout)||a.isNil(null===(t=this.processedLayout)||void 0===t?void 0:t.script)?[]:this.processedLayout.script.split(",")},t.prototype.getIntInRangeOrDefault=function(t,e,n,i){return void 0===t||(t=Math.round(t))<e||n<t?i:t},t.prototype.getNumberInRangeOrDefault=function(t,e,n,i){return void 0===t||t<e||n<t?i:t},t.prototype.getBooleanOrDefault=function(t,e){return void 0===t?e:t},t.prototype.setupConfig=function(){var t,e,n=this;this.positionConfig=Object(a.cloneDeep)(this.positionConfigDefaults),this.processLayoutConfig();var i=this.processedLayout;if(!a.isNil(i.clone)||!a.isNil(this.getParent())){var o=this.getParent().getChildren()[i.clone];if(!Object(a.isNil)(o)&&!a.isNil(o.getLayout())){this.positionConfig.clone=i.clone;var r=Object(a.cloneDeep)(o.getLayout());Object.assign(r,i),i=r}}void 0!==i.construction&&(this.positionConfig.construction=i.construction);var s=this.getIntInRangeOrDefault(i.h,1,99999,-1),l=this.getParent();s>0&&void 0!==l&&"absolute"!==l.positionConfig.construction?this.positionConfig.minH=this.positionConfig.maxH=s:(this.positionConfig.minH=this.getIntInRangeOrDefault(i.minH,1,99999,-1),this.positionConfig.maxH=this.getIntInRangeOrDefault(i.maxH,1,99999,-1));var p=this.getIntInRangeOrDefault(i.w,1,99999,-1);if(p>0&&void 0!==l&&"absolute"!==l.positionConfig.construction?this.positionConfig.minW=this.positionConfig.maxW=p:(this.positionConfig.minW=this.getIntInRangeOrDefault(i.minW,1,99999,-1),this.positionConfig.maxW=this.getIntInRangeOrDefault(i.maxW,1,99999,-1)),this.positionConfig.fillX=this.getNumberInRangeOrDefault(i.fillX,0,99999,0),this.positionConfig.fillY=this.getNumberInRangeOrDefault(i.fillY,0,99999,0),this.positionConfig.initW=this.getNumberInRangeOrDefault(i.initW,0,99999,-1),this.positionConfig.initH=this.getNumberInRangeOrDefault(i.initH,0,99999,-1),this.positionConfig.x=this.getNumberInRangeOrDefault(i.x,0,99999,-1),this.positionConfig.y=this.getNumberInRangeOrDefault(i.y,0,99999,-1),this.positionConfig.h=this.getNumberInRangeOrDefault(i.h,0,99999,-1),this.positionConfig.w=this.getNumberInRangeOrDefault(i.w,0,99999,-1),this.positionConfig.index=this.getNumberInRangeOrDefault(i.index,0,99999,-1),this.positionConfig.hidden=this.getBooleanOrDefault(i.hidden,!1),this.positionConfig.append=!1,this.positionConfig.newline=!1,this.positionConfig.eol=!1,this.positionConfig.alignRight=!1,this.positionConfig.alignCenter=!1,this.positionConfig.alignBottom=!1,this.positionConfig.alignMiddle=!1,this.positionConfig.lineAlignBottom=!1,this.positionConfig.lineAlignMiddle=!1,this.positionConfig.stickyAuto=!1,this.positionConfig.stickyFloat=!1,this.getScript().forEach(function(t){switch(t){case"append":n.positionConfig.append=!0;break;case"newline":n.positionConfig.newline=!0;break;case"eol":n.positionConfig.eol=!0;break;case"alignRight":n.positionConfig.alignRight=!0;break;case"alignCenter":n.positionConfig.alignCenter=!0;break;case"alignBottom":n.positionConfig.alignBottom=!0;break;case"alignMiddle":n.positionConfig.alignMiddle=!0;break;case"lineAlignBottom":n.positionConfig.lineAlignBottom=!0;break;case"lineAlignMiddle":n.positionConfig.lineAlignMiddle=!0;break;case"sticky-tl":n.positionConfig.sticky=36;break;case"sticky-tc":n.positionConfig.sticky=34;break;case"sticky":case"sticky-tr":n.positionConfig.sticky=33;break;case"sticky-ml":n.positionConfig.sticky=20;break;case"sticky-mc":n.positionConfig.sticky=18;break;case"sticky-mr":n.positionConfig.sticky=17;break;case"sticky-bl":n.positionConfig.sticky=12;break;case"sticky-bc":n.positionConfig.sticky=10;break;case"sticky-br":n.positionConfig.sticky=9;break;case"stickyAuto":n.positionConfig.stickyAuto=!0,0==n.positionConfig.sticky&&(n.positionConfig.sticky=33);break;case"stickyFloat":n.positionConfig.stickyFloat=!0,0==n.positionConfig.sticky&&(n.positionConfig.sticky=33);break;case"stickyBehind":n.positionConfig.stickyBehind=!0,0==n.positionConfig.sticky&&(n.positionConfig.sticky=33);break;case"stickyParentSize":n.positionConfig.stickyParentSize=!0;break;case"selfSized":n.positionConfig.selfSized=!0;break;case"parentSized":n.positionConfig.parentSized=!0;break;case"expandR":n.positionConfig.expansion|=1;break;case"":break;default:console.error("Unknown script command: ",n.getId(),"=>",t)}}),this.positionConfig.layer=this.getNumberInRangeOrDefault(i.layer,1,99999,1),"group"===this.getType()){var d=a.isNil(null===(t=this.el.pluginConfig.config)||void 0===t?void 0:t.layoutConfig)?{}:null===(e=this.el.pluginConfig.config)||void 0===e?void 0:e.layoutConfig;this.positionConfig.groupConfig.innerPadding=this.getIntInRangeOrDefault(d.innerPadding,-99999,99999,0),this.positionConfig.groupConfig.elementsPadding=this.getIntInRangeOrDefault(d.elementsPadding,0,99999,0),this.positionConfig.groupConfig.pageCenter=this.getBooleanOrDefault(d.pageCenter,!1),this.positionConfig.groupConfig.pageMiddle=this.getBooleanOrDefault(d.pageMiddle,!1),this.positionConfig.groupConfig.justifiedGrid=this.getBooleanOrDefault(d.justifiedGrid,!1)}},t.prototype.getParentDom=function(){return this.el.currentParentContext.pluginComponentRef.instance.wrapperEl.nativeElement},t.prototype.getParentVC=function(){return this.el.currentParentContext.pluginComponentRef.instance.targetVC},t.prototype.getParentContext=function(){return this.el.parentContext},t.prototype.getWrapperDom=function(){var t,e;return null===(e=null===(t=this.el)||void 0===t?void 0:t.wrapperComponentRef)||void 0===e?void 0:e.location.nativeElement},t.prototype.getPluginDom=function(){return this.el.pluginComponentRef.location.nativeElement},t.prototype.getPlugin=function(){return this.el.pluginComponentRef},t.prototype.getTargetVC=function(){return"group"!==this.getType()?(console.warn("Only groups have target ViewContainer"),null):this.el.pluginComponentRef.instance.targetVC},t.prototype.getType=function(){return this.el.pluginConfig.type},t.prototype.getId=function(){return this.el.id},t.prototype.getChildren=function(){return"group"===this.getType()?this.el.pluginComponentRef.instance.layoutElements:null},t.prototype.getWrapper=function(){return this.el.wrapperComponentRef.instance},t.prototype.getLayout=function(){return this.el.pluginConfig.layout},t.prototype.getLayoutConfig=function(){var t;return null===(t=this.el.parentContext.pluginConfig.config)||void 0===t?void 0:t.layoutConfig},t.prototype.getConfig=function(){return this.el.pluginConfig},t.prototype.getScrolledDom=function(){return"group"===this.getType()?this.el.pluginComponentRef.instance.wrapperEl.nativeElement:null},t.prototype.getLocalMousePosition=function(){var t=this.layoutController.mousePos,e=this.getWrapperDom().getBoundingClientRect();return{x:t.x-e.left,y:t.y-e.top}},t.prototype.getRootVC=function(){return this.el.rootContext.pluginComponentRef.instance.targetVC},t.prototype.redraw=function(){return this.el.redraw$.next()},t.prototype.calculateNaturalSize=function(){var t=0,e=0;if(this.getScrolledDom()&&(t=this.getScrolledDom().scrollTop,e=this.getScrolledDom().scrollLeft),void 0!==this.el.wrapperComponentRef){if(1==this.positionConfig.calculated||2==this.positionConfig.calculated)return this.positionConfig.hidden&&(this.positionConfig.calculated=3),{width:this.nextState.naturalWidth,height:this.nextState.naturalHeight,clientWidth:this.nextState.naturalWidth,clientHeight:this.nextState.naturalHeight};if(this.positionConfig.hidden)return this.positionConfig.calculated=3,{width:0,height:0,clientWidth:0,clientHeight:0};if(this.positionConfig.h>0&&this.positionConfig.w>0)return this.positionConfig.calculated=1,{width:this.positionConfig.w,height:this.positionConfig.h,clientWidth:this.positionConfig.w,clientHeight:this.positionConfig.h};var n,i,o,r,s,l,p=this.getWrapperDom().style.position;this.renderer.setStyle(this.getWrapperDom(),"position","absolute"),Object(a.isNil)(this.getWrapperDom().parentNode)||(n=this.getWrapperDom().parentNode.style.minWidth,i=this.getWrapperDom().parentNode.style.minHeight,s=this.getWrapperDom().parentNode.style.maxWidth,l=this.getWrapperDom().parentNode.style.maxHeight,o=this.getWrapperDom().parentNode.style.minWidth,r=this.getWrapperDom().parentNode.style.minHeight,this.renderer.setStyle(this.getWrapperDom().parentNode,"min-width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"min-height","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-height","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"height","99999px"),"none"===this.getWrapperDom().style.display&&!1===this.positionConfig.hidden&&this.renderer.removeStyle(this.getWrapperDom(),"display")),this.renderer.removeStyle(this.getWrapperDom(),"width"),this.renderer.removeStyle(this.getWrapperDom(),"height"),this.renderer.removeStyle(this.getWrapperDom(),"max-width"),this.renderer.removeStyle(this.getWrapperDom(),"max-height");var d=this.getWrapperDom().style.top,h=this.getWrapperDom().style.left,u=this.getWrapperDom().style.transition;this.renderer.setStyle(this.getWrapperDom(),"transition","none"),3!=this.positionConfig.calculated&&(this.renderer.setStyle(this.getWrapperDom(),"top",0),this.renderer.setStyle(this.getWrapperDom(),"left",0));var c=this.el.pluginComponentRef.location.nativeElement,g=c.style.maxWidth,f=c.style.maxHeight,m=c.style.minWidth,v=c.style.minHeight;this.positionConfig.maxW>0&&this.renderer.setStyle(c,"max-width",this.positionConfig.maxW+"px"),this.positionConfig.minW>0&&this.renderer.setStyle(c,"min-width",this.positionConfig.minW+"px"),this.positionConfig.maxH>0&&this.renderer.setStyle(c,"max-height",this.positionConfig.maxH+"px"),this.positionConfig.minH>0&&this.renderer.setStyle(c,"min-height",this.positionConfig.minH+"px");var y=c;"group"===this.getType()&&(y=this.el.pluginComponentRef.instance.wrapperEl.nativeElement);var C=y.getBoundingClientRect(),x=this.positionConfig.parentSized?{width:0,height:0,clientWidth:0,clientHeight:0}:{width:C.width,height:C.height,clientWidth:y.clientWidth,clientHeight:y.clientHeight};return-1!=this.positionConfig.initW&&(x.width=this.positionConfig.initW),-1!=this.positionConfig.initH&&(x.height=this.positionConfig.initH),this.positionConfig.maxH>0&&x.height>this.positionConfig.maxH&&(x.height=this.positionConfig.maxH),this.positionConfig.minH>0&&x.height<this.positionConfig.minH&&(x.height=this.positionConfig.minH),this.positionConfig.maxW>0&&x.width>this.positionConfig.maxW&&(x.width=this.positionConfig.maxW),this.positionConfig.minW>0&&x.width<this.positionConfig.minW&&(x.width=this.positionConfig.minW),this.positionConfig.maxW>0&&this.renderer.setStyle(c,"max-width",g),this.positionConfig.minW>0&&this.renderer.setStyle(c,"min-width",m),this.positionConfig.maxH>0&&this.renderer.setStyle(c,"max-height",f),this.positionConfig.minH>0&&this.renderer.setStyle(c,"min-height",v),Object(a.isNil)(this.getWrapperDom().parentNode)||(this.renderer.setStyle(this.getWrapperDom().parentNode,"min-width",o),this.renderer.setStyle(this.getWrapperDom().parentNode,"min-height",r),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-width",s),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-height",l),this.renderer.setStyle(this.getWrapperDom().parentNode,"width",n),this.renderer.setStyle(this.getWrapperDom().parentNode,"height",i)),this.renderer.setStyle(this.getWrapperDom(),"top",d),this.renderer.setStyle(this.getWrapperDom(),"left",h),this.renderer.setStyle(this.getWrapperDom(),"transition",u),this.renderer.setStyle(this.el.wrapperComponentRef.location.nativeElement,"position",p),this.positionConfig.calculated=this.positionConfig.hidden?3:1,this.getScrolledDom()&&(this.getScrolledDom().scrollTop=t,this.getScrolledDom().scrollLeft=e),x}},t.prototype.setNextState=function(t){Object.assign(this.nextState,t)},t.prototype.updateState=function(){this.applyState(this.nextState)},t.prototype.resetState=function(){this.nextState=Object(a.cloneDeep)(this.activeState),this.applyState(this.nextState)},t.prototype.commitState=function(){var t=this.nextState;this.activeState=Object.assign(this.activeState,this.nextState),this.applyState(t)},t.prototype.applyState=function(t){var e=this.getWrapperDom();this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",t.top+"px"),this.renderer.setStyle(e,"width",t.width+"px"),this.renderer.setStyle(e,"height",t.height+"px"),this.renderer.setStyle(e,"max-width",t.width+"px"),this.renderer.setStyle(e,"max-height",t.height+"px"),this.renderer.setStyle(e,"z-index",t.zIndex),this.renderer.setStyle(e,"opacity",t.opacity),this.renderer.setStyle(e,"transition",t.transition),this.renderer.setStyle(e,"padding",(Object(a.isNil)(t.paddingTop)?0:t.paddingTop)+"px\n      "+(Object(a.isNil)(t.paddingRight)?0:t.paddingRight)+"px\n      "+(Object(a.isNil)(t.paddingBottom)?0:t.paddingBottom)+"px\n      "+(Object(a.isNil)(t.paddingLeft)?0:t.paddingLeft)+"px")},t.prototype.applyStyles=function(t){var e=this,n=this.getWrapperDom();Object.keys(t).forEach(function(i){e.renderer.setStyle(n,i,t[i])})},t.prototype.destroy=function(){var t,e=this;clearTimeout(this.mouseLeaveTimeoutHelper),null===(t=this.layoutController)||void 0===t||t.positionController.onElementDestroy(this),Object.keys(this.internalListeners).forEach(function(t){e.internalListeners[t]()}),Object.keys(this.eventListeners).forEach(function(t){e.eventListeners[t]()}),this.el.destroy()},t}(),h=["buttonsRef"],u=function(t,e){return{top:t,right:e}};function c(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"app-layout-element-button-controls",4,5),o["\u0275\u0275listener"]("buttonEvent",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().handleButtonEvent(t)}),o["\u0275\u0275elementEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("editButtons",i.editButtons)("ngClass",o["\u0275\u0275pureFunction2"](3,u,i.buttons&&i.top+i.elRef.nativeElement.offsetHeight+i.buttons.nativeElement.offsetHeight>i.elRef.nativeElement.parentElement.clientHeight+i.elRef.nativeElement.parentElement.scrollTop,i.buttons&&i.left-(i.buttons.nativeElement.offsetWidth-i.elRef.nativeElement.offsetWidth)<0))("dragActive",i.dragActive)}}var g=function(t){return{"drag-active":t}};function f(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementContainerStart"](0),o["\u0275\u0275elementStart"](1,"div",6),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"n")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](2,"div",7),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"s")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"div",8),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"w")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"div",9),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"e")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"div",10),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"nw")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](6,"div",11),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"ne")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"div",12),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"sw")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"div",13),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"se")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"div",14),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"n")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](10,"div",15),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"s")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"div",16),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"w")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](12,"div",17),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"e")}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](13,"div",18),o["\u0275\u0275listener"]("mousedown",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().dragStart(t)}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementContainerEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](13),o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](1,g,i.dragActive))}}var m=function(){function t(t,e,n){this.renderer=t,this.cd=e,this.elRef=n,this.ids=[],this.dragStart$=new p.Subject,this.drag$=new p.Subject,this.dragEnd$=new p.Subject,this.scale$=new p.Subject,this.scaleEnd$=new p.Subject,this.scaleStart$=new p.Subject,this.mouseEnter$=new p.Subject,this.mouseLeave$=new p.Subject,this.click$=new p.Subject,this.buttonEvent$=new p.Subject,this.doubleClick$=new p.Subject,this.bgStyle={},this.dragActive=!1,this.scaleActive=!1,this.dragData={startX:0,startY:0,deltaX:0,deltaY:0,mouseX:0,mouseY:0},this.isMouseOver=!1,this.renderer.setStyle(this.elRef.nativeElement,"z-index",1e5)}return t.prototype.evt=function(t){this.click$.next({ids:this.ids,data:null,e:t})},t.prototype.mouseUp=function(t){clearTimeout(this.dragTimer)},t.prototype.mouseEnter=function(t){this.isMouseOver=!0,this.mouseEnter$.next({ids:this.ids,data:t,e:t})},t.prototype.mouseLeave=function(t){this.isMouseOver=!1,this.mouseLeave$.next({ids:this.ids,data:t,e:t})},t.prototype.handleButtonEvent=function(t){t.editButton.supportDrag?(this.editButton=t.editButton,this.dragStart(t.event,this.editButton)):this.buttonEvent$.next({ids:this.ids,data:null,editButton:t.editButton,e:t.event})},t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.cd.detectChanges()},t.prototype.applyBgStyle=function(t){Object.assign(this.bgStyle,t),this.cd.markForCheck()},t.prototype.doubleClick=function(t){this.doubleClick$.next({ids:this.ids,data:null,e:t})},t.prototype.setIds=function(t){this.ids=t},t.prototype.dragStart=function(t,e){var n,i=this;void 0===e&&(e=null),clearTimeout(this.dragTimer),t.preventDefault();var o=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.startX=t.clientX-o.left,this.dragData.startY=t.clientY-o.top,this.dragData.mouseX=t.clientX,this.dragData.mouseY=t.clientY,this.dragTimer=setTimeout(function(n){i.dragActive=!0,delete i.dragData.direction,i.registerMouseListeners(),i.dragStart$.next({ids:i.ids,data:i.dragData,editButton:e,e:t})},Object(a.isNil)(null===(n=this.draggable)||void 0===n?void 0:n.delay)?0:this.draggable.delay)},t.prototype.scaleStart=function(t,e){t.preventDefault();var n=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.startX=t.clientX-n.left,this.dragData.startY=t.clientY-n.top,this.dragData.direction=e,this.scaleActive=!0,this.registerMouseListeners(),this.scaleStart$.next({ids:this.ids,data:this.dragData,e:t})},t.prototype.onMouseMove=function(t){var e=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.deltaX=t.clientX-e.left-this.dragData.startX,this.dragData.deltaY=t.clientY-e.top-this.dragData.startY,this.dragData.mouseX=t.clientX,this.dragData.mouseY=t.clientY,this.dragActive&&this.drag$.next({ids:this.ids,data:this.dragData,editButton:this.editButton,e:t}),this.scaleActive&&this.scale$.next({ids:this.ids,data:this.dragData,e:t})},t.prototype.onMouseUp=function(t){this.dragActive&&this.dragEnd$.next({ids:this.ids,data:this.dragData,editButton:this.editButton,e:t}),this.scaleActive&&this.scaleEnd$.next({ids:this.ids,data:this.dragData,e:t}),this.editButton=null,this.dragActive=!1,this.scaleActive=!1,this.cleanUpMouseListeners(),this.cd.markForCheck()},t.prototype.registerMouseListeners=function(){var t=this;this.cleanUpMouseListeners(),this.mouseUpListener=this.renderer.listen("window","mouseup",function(e){return t.onMouseUp(e)}),this.mouseMoveListener=this.renderer.listen("window","mousemove",function(e){return t.onMouseMove(e)})},t.prototype.cleanUpMouseListeners=function(){this.mouseUpListener&&this.mouseUpListener(),this.mouseMoveListener&&this.mouseMoveListener()},t.prototype.ngOnDestroy=function(){this.scaleActive&&this.scaleEnd$.next({ids:this.ids,data:this.dragData,e:null}),this.dragActive&&this.dragEnd$.next({ids:this.ids,data:this.dragData,editButton:this.editButton,e:null}),this.cleanUpMouseListeners()},t.prototype.setPos=function(t){this.top=t.top,this.left=t.left;var e=this.elRef.nativeElement;this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",t.top+"px")},t.prototype.setSize=function(t){var e=this.elRef.nativeElement;this.renderer.setStyle(e,"width",t.width+"px"),this.renderer.setStyle(e,"height",t.height+"px"),this.renderer.setStyle(e,"max-width",t.width+"px"),this.renderer.setStyle(e,"max-height",t.height+"px")},t.prototype.setTransition=function(t){this.renderer.setStyle(this.elRef.nativeElement,"transition",t)},t.prototype.hide=function(){this.renderer.setStyle(this.elRef.nativeElement,"display","none")},t.prototype.show=function(){this.renderer.setStyle(this.elRef.nativeElement,"display","block")},t.prototype.update=function(){this.layoutController.updateControl()},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.Renderer2),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](o.ElementRef))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-layout-element-controls"]],viewQuery:function(t,e){var n;1&t&&o["\u0275\u0275viewQuery"](h,!0,o.ElementRef),2&t&&o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.buttons=n.first)},hostBindings:function(t,e){1&t&&o["\u0275\u0275listener"]("click",function(t){return e.evt(t)})("mouseup",function(t){return e.mouseUp(t)},!1,o["\u0275\u0275resolveDocument"])("mouseenter",function(t){return e.mouseEnter(t)})("mouseleave",function(t){return e.mouseLeave(t)})},decls:4,vars:6,consts:[["class","control-buttons",3,"editButtons","ngClass","dragActive","buttonEvent",4,"ngIf"],[1,"wrapper",3,"dblclick"],[1,"bg",3,"ngClass","ngStyle","mousedown"],[4,"ngIf"],[1,"control-buttons",3,"editButtons","ngClass","dragActive","buttonEvent"],["buttonsRef",""],[1,"drag","horizontal","top",3,"mousedown"],[1,"drag","horizontal","bottom",3,"mousedown"],[1,"drag","vertical","left",3,"mousedown"],[1,"drag","vertical","right",3,"mousedown"],[1,"drag","corner","nw",3,"mousedown"],[1,"drag","corner","ne",3,"mousedown"],[1,"drag","corner","sw",3,"mousedown"],[1,"drag","corner","se",3,"mousedown"],[1,"drag","center-control","n",3,"mousedown"],[1,"drag","center-control","s",3,"mousedown"],[1,"drag","center-control","w",3,"mousedown"],[1,"drag","center-control","e",3,"mousedown"],[1,"drag","center-drag",3,"ngClass","mousedown"]],template:function(t,e){1&t&&(o["\u0275\u0275template"](0,c,2,6,"app-layout-element-button-controls",0),o["\u0275\u0275elementStart"](1,"div",1),o["\u0275\u0275listener"]("dblclick",function(t){return e.doubleClick(t)}),o["\u0275\u0275elementStart"](2,"div",2),o["\u0275\u0275listener"]("mousedown",function(t){return e.dragStart(t)}),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](3,f,14,3,"ng-container",3),o["\u0275\u0275elementEnd"]()),2&t&&(o["\u0275\u0275property"]("ngIf",e.editButtons),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](4,g,e.dragActive))("ngStyle",e.bgStyle),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",null==e.draggable?null:e.draggable.scalable))},styles:['[_nghost-%COMP%]{outline:3px solid rgba(var(--theme-accent-500),.5);outline-offset:-3px;width:100%;height:100%;top:0;left:0;position:absolute;pointer-events:none;cursor:"grabbing"}.cantDrop[_nghost-%COMP%]{outline:3px solid rgba(var(--theme-warn-500),.5)}.cantDrop[_nghost-%COMP%], .cantDrop[_nghost-%COMP%]   .bg[_ngcontent-%COMP%]{cursor:"no-drop"!important}[_nghost-%COMP%]   .control-buttons[_ngcontent-%COMP%]{position:absolute;bottom:100%;right:0;top:100%;bottom:auto;pointer-events:all}[_nghost-%COMP%]   .control-buttons.top[_ngcontent-%COMP%]{bottom:100%;top:auto}[_nghost-%COMP%]   .control-buttons.right[_ngcontent-%COMP%]{left:0;right:auto}.wrapper[_ngcontent-%COMP%]{top:0;left:0;opacity:1;transition:opacity .2s;pointer-events:none}.bg[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.bg[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.bg.drag-active[_ngcontent-%COMP%]{pointer-events:all}.info[_ngcontent-%COMP%]{top:15px;left:15px;word-wrap:break-word;max-width:100%;padding:5px;-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none;font-size:10px;background-color:rgba(50,50,50,.5)}.corner[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]{position:absolute}.corner[_ngcontent-%COMP%]{pointer-events:all;width:10px;height:10px;background-color:rgba(var(--theme-background-600));border:2px solid rgba(var(--theme-accent-600));border-radius:5px}.corner.nw[_ngcontent-%COMP%]{top:-5px;left:-5px;cursor:nw-resize}.corner.ne[_ngcontent-%COMP%]{top:-5px;right:-5px;cursor:ne-resize}.corner.sw[_ngcontent-%COMP%]{bottom:-5px;left:-5px;cursor:sw-resize}.corner.se[_ngcontent-%COMP%]{bottom:-5px;right:-5px;cursor:se-resize}.center-drag[_ngcontent-%COMP%]{width:10px;height:10px;position:absolute;background-color:rgba(var(--theme-accent-600));border-radius:5px;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);pointer-events:all;cursor:-webkit-grab;cursor:grab}.center-drag.drag-active[_ngcontent-%COMP%]{cursor:-webkit-grabbing;cursor:grabbing}.center-control[_ngcontent-%COMP%]{pointer-events:all;width:7px;height:7px;position:absolute;background-color:rgba(var(--theme-accent-600));border-radius:5px}.center-control.n[_ngcontent-%COMP%]{top:-3.5px;left:calc(50% - 3.5px);cursor:n-resize}.center-control.s[_ngcontent-%COMP%]{bottom:-3.5px;left:calc(50% - 3.5px);cursor:s-resize}.center-control.w[_ngcontent-%COMP%]{left:-3.5px;cursor:w-resize}.center-control.e[_ngcontent-%COMP%], .center-control.w[_ngcontent-%COMP%]{top:calc(50% - 3.5px);transform:rotate(90deg)}.center-control.e[_ngcontent-%COMP%]{right:-3.5px;cursor:e-resize}.horizontal[_ngcontent-%COMP%]{pointer-events:all;cursor:n-resize;position:absolute;width:100%;height:10px;left:0}.horizontal.top[_ngcontent-%COMP%]{top:0}.horizontal.bottom[_ngcontent-%COMP%]{cursor:s-resize;bottom:0}.vertical[_ngcontent-%COMP%]{pointer-events:all;cursor:w-resize;position:absolute;height:100%;width:10px;top:0}.vertical.left[_ngcontent-%COMP%]{left:0}.vertical.right[_ngcontent-%COMP%]{cursor:e-resize;right:0}.topleft[_ngcontent-%COMP%]{cursor:nw-resize;left:0;top:0}.topright[_ngcontent-%COMP%]{cursor:ne-resize;right:0;top:0}.bottomleft[_ngcontent-%COMP%]{cursor:sw-resize;left:0;bottom:0}.bottomright[_ngcontent-%COMP%]{cursor:se-resize;right:0;bottom:0}']}),t}(),v=function(){function t(){this.running=!1,this.speedY=0,this.speedX=0}return t.prototype.startAnim=function(){this.running||(this.running=!0,this.frameId=window.requestAnimationFrame(this.animate.bind(this)))},t.prototype.stopAnim=function(){window.cancelAnimationFrame(this.frameId),this.running=!1},t.prototype.animate=function(){this.el&&(this.el.scrollTop+=this.speedY,this.el.scrollLeft+=this.speedX),this.running&&(this.frameId=window.requestAnimationFrame(this.animate.bind(this)))},t.prototype.updateEl=function(t){this.el&&(this.el.style.scrollBehavior=this.origScrollBehavior),this.el=t,this.el&&(this.origScrollBehavior=getComputedStyle(this.el).scrollBehavior,this.el.style.scrollBehavior="auto")},t.prototype.setScrollSpeed=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.el!==t&&this.updateEl(t),this.speedX=e,this.speedY=n,this.startAnim()},t.prototype.stopScroll=function(){this.updateEl(null),this.stopAnim()},t}(),y=function(){function t(t,e){this.rootEl=t,this.layoutController=e,this.scrollController=new v,this.tempElements={},this.timeouts=[],this.activeElements=[],this.maintenanceActivated=!1,this.maintenanceFrequency=1e3,this.dragTimeout=80,this.maintenanceRootSizeMismatch=0,this.maintenanceCounter=0,this.destroy$=new p.Subject,this.elementSizeChanged$=new p.Subject,this.dragStart$=new p.Subject,this.dragEnd$=new p.Subject,this.dragTempData={},this.isDragging=!1,this.transition="left 0.3s, top 0.3s, width 0.3s, height 0.3s, max-width 0.3s, min-width 0.3s, max-height 0.3s, min-height 0.3s, outline 0.3s",this.transitionNone="outline 0.3s"}return t.prototype.init=function(){var t=this;this.initEl(this.rootEl,!1,!0),this.elementSizeChanged$.pipe(Object(l.takeUntil)(this.destroy$)).subscribe(function(){}),this.elementSizeChanged$.pipe(Object(l.takeUntil)(this.destroy$),Object(r.bufferedDebounceTime)(200)).subscribe(function(e){e.forEach(function(t){t.el.positionConfig.calculated=3}),t.initEl(t.rootEl,!1)}),this.unlistenLoadingDone=this.layoutController.renderer.listen(document.fonts,"loadingdone",function(){t.initEl(t.rootEl,!0,!0)})},t.prototype.disableTransitions=function(t){var e=this;t.getWrapperDom()&&this.layoutController.renderer.setStyle(t.getWrapperDom(),"transition",this.transitionNone);var n=t.getChildren();n&&Object.values(n).forEach(function(t){return e.disableTransitions(t)})},t.prototype.enableTransitions=function(t){var e=this;t.getWrapperDom()&&this.layoutController.renderer.setStyle(t.getWrapperDom(),"transition",this.transition);var n=t.getChildren();n&&Object.values(n).forEach(function(t){return e.enableTransitions(t)})},t.prototype.getSortedElementList=function(t,e){var n=t.getChildren(),i=[];if(n){for(var o={},r=1e3,a=0,s=Object.values(n);a<s.length;a++){var l=s[a];if(!(l.positionConfig.hidden||0!==e&&e!==l.positionConfig.layer)){var p=l.positionConfig.index;(p<0||p+1e4 in o)&&(p=r++),o[p+1e4]=l}}Object.keys(o).sort().forEach(function(t){return i.push(o[t])})}return i},t.prototype.dump=function(t){console.log(t.getId(),t.activeState.width,t.activeState.height)},t.prototype.recalculateLayout=function(t,e){void 0!==this.rootEl.el.wrapperComponentRef&&(this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"width","100%"),this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"height","100%"),t=this.rootEl.getWrapperDom().offsetWidth,e=this.rootEl.getWrapperDom().offsetHeight,this.rootEl.setNextState({width:t,height:e,renderedContentWidth:t,renderedContentHeight:e,naturalWidth:t,naturalHeight:e}),this.recalculateLayoutHelper(this.rootEl,0,0),this.rootEl.commitState(),this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"width","100%"),this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"height","100%"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"max-width"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"min-width"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"max-height"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"min-height"))},t.prototype.recalculateLayoutHelper=function(t,e,n){var i=this;if(t.applyMinMaxToNextStateNaturalSize(),0===e){var o=new Set;return Object.values(t.getChildren()).forEach(function(t){return o.add(t.positionConfig.layer)}),Array.from(o).sort().forEach(function(e){return i.recalculateLayoutHelper(t,e,e)}),void t.redraw()}var r,a,s=t.positionConfig.groupConfig.innerPadding,l=t.positionConfig.groupConfig.elementsPadding,p=t.getChildren(),d=[],h=[],u=[],c=this.getSortedElementList(t,n),g=-1;if(t!==this.rootEl&&"absolute"===t.positionConfig.construction){var f=this.getElementRect(t),m=(f.x1-f.x0)/1e3,v=(f.y1-f.y0)/1e3;return c.forEach(function(t){var n=t.getLayout();t.setNextState({left:n.x*m,top:n.y*v,width:n.w*m,height:n.h*v,naturalWidth:n.w*m,naturalHeight:n.h*v,zIndex:10*e}),t.commitState()}),y.bind(this)(),void t.redraw()}return(function(){var n=this,i=!1,o=void 0,p=0,h=0;C(),c.forEach(function(c){if("group"===c.getType()){if(c.setNextState({naturalWidth:0,naturalHeight:0}),c.positionConfig.selfSized){if(c.positionConfig.fillX>0){var f=(t.nextState.naturalWidth-2*s-2*l)*c.positionConfig.fillX/100;f>t.nextState.naturalWidth?f=t.nextState.naturalWidth:f<0&&(f=0),1&c.positionConfig.expansion&&(f+=l),c.setNextState({naturalWidth:f})}c.applyMinMaxToNextStateNaturalSize(),n.recalculateLayoutHelper(c,e,0)}c.applyMinMaxToNextStateNaturalSize()}if(0!==c.positionConfig.sticky&&void 0!==o)return u.push({holder:o,sticker:c}),void(c.positionConfig.stickerHolder=o);var m=c.nextState.naturalWidth+2*l;c.setNextState({width:c.nextState.naturalWidth,height:c.nextState.naturalHeight}),(i||!c.positionConfig.append&&d[g].length>0&&(c.positionConfig.newline||a+m+s>t.nextState.naturalWidth))&&C(),d[g].push(c),c.setNextState({left:a+l,top:r+l,width:c.nextState.naturalWidth,height:c.nextState.naturalHeight,zIndex:10*e}),p=Math.max(p,a+l+c.nextState.naturalWidth),h=Math.max(h,r+l+c.nextState.naturalHeight),a+=m,i=c.positionConfig.eol,o=c}),0==c.length&&(p=h=s),p+=s+l,h+=s+l,t.positionConfig.selfSized&&(p>t.nextState.naturalWidth&&t.setNextState({naturalWidth:p}),h>t.nextState.naturalHeight&&t.setNextState({naturalHeight:h}))}).bind(this)(),d.forEach(function(e){if(!(t.nextState.naturalWidth-S(e)<1)){var n=!1;if(e.forEach(function(t){return n=n||0!==t.positionConfig.fillX}),n){var i,o=t.nextState.naturalWidth-2*s;if(b(o,e)<=t.nextState.naturalWidth)i=o;else for(i=0;o-i>=.001;){var r=(o+i)/2;b(r,e)<=t.nextState.naturalWidth?i=r:o=r}a=s,e.forEach(function(t){t.nextState.left=a+l,t.nextState.width=E(i,e,t),a+=t.nextState.width+2*l})}}}),function(){var e=[];if(d.forEach(function(t,n){for(var i=0;i<t.length;i++)if(t[i].positionConfig.fillY){e.push(n);break}}),0!==e.length){var n,i=t.nextState.naturalHeight-2*s,o=i;if(w(i)<=t.nextState.naturalHeight)n=i;else for(n=0;i-n>=.001;){var a=(i+n)/2;w(a)<=t.nextState.naturalHeight?n=a:i=a}e.forEach(function(t){var e=D(n,t);d[t].forEach(function(t){if(0!==t.positionConfig.fillY){var n=t.positionConfig.fillY*o/100;n<t.nextState.height&&(n=t.nextState.height),t.nextState.height=Math.min(-1===t.positionConfig.maxH?n:t.positionConfig.maxH,n,e)}})}),r=s,d.forEach(function(t){t.forEach(function(t){return t.nextState.top=r+l}),r+=x(t)})}}(),d.forEach(function(e){for(var n=t.nextState.naturalWidth-S(e),i=0;i<e.length&&n>0;i++){var o=e[i];if(o.positionConfig.alignRight){for(var r=i;r<e.length;r++)e[r].nextState.left+=n;break}if(o.positionConfig.alignCenter){var a=(t.nextState.naturalWidth-o.nextState.width)/2;if(a<=o.nextState.left)continue;var s=a-o.nextState.left;for(s>n&&(s=n),r=i;r<e.length;r++)e[r].nextState.left+=s;n-=s}}}),(function(){r=s,d.forEach(function(t){h.push(r+l);var e=x(t)-2*l;t.forEach(function(t){t.positionConfig.alignMiddle&&(t.nextState.top=(e-t.nextState.height)/2+r+l),t.positionConfig.alignBottom&&(t.nextState.top=e-t.nextState.height+r+l)}),r+=e+2*l}),t===this.rootEl&&(r+=s)>t.nextState.height&&(t.nextState.height=r)}).bind(this)(),function(){var e=2*s;d.forEach(function(t){return e+=x(t)});for(var n=t.nextState.naturalHeight-e,i=function(e){var i=!1,o=!1;if(d[e].forEach(function(t){i=i||t.positionConfig.lineAlignBottom,o=o||t.positionConfig.lineAlignMiddle}),i){for(var r=e;r<d.length;r++)d[r].forEach(function(t){return t.nextState.top+=n});return"break"}if(o){var a=(t.nextState.naturalHeight-x(d[e]))/2+l;if(a<=h[e])return"continue";var s=a-h[e];for(s>n&&(s=n),r=e;r<d.length;r++)d[r].forEach(function(t){return t.nextState.top+=s}),h[r]+=s;n-=s}},o=0;o<d.length&&n>0&&"break"!==i(o);o++);}(),(function(){t.positionConfig.groupConfig.pageCenter&&d.forEach(function(e){var n=S(e);if(n<t.nextState.naturalWidth){var i=(t.nextState.naturalWidth-n)/2;e.forEach(function(t){return t.nextState.left+=i})}})}).bind(this)(),(function(){if(t.positionConfig.groupConfig.pageMiddle){var e=0;if(c.forEach(function(t){var n=t.nextState.top+t.nextState.height-1+l;n>e&&(e=n)}),!(e>=t.nextState.naturalHeight-s-1)){var n=(t.nextState.naturalHeight-s-1-e)/2;c.forEach(function(t){return t.nextState.top+=n})}}}).bind(this)(),(function(){u.forEach(function(t){var n,i,o,r=t.sticker.positionConfig.sticky;if(t.sticker.positionConfig.stickyParentSize&&(t.sticker.nextState.naturalWidth=t.holder.nextState.width,t.sticker.nextState.naturalHeight=t.holder.nextState.height,t.sticker.nextState.width=t.holder.nextState.width,t.sticker.nextState.height=t.holder.nextState.height),t.sticker.positionConfig.stickyFloat){var a=t.sticker.nextState.naturalHeight/2;(o=Math.max(t.sticker.getParent().positionConfig.groupConfig.innerPadding,t.sticker.getParent().positionConfig.groupConfig.elementsPadding)+t.sticker.getParent().positionConfig.groupConfig.elementsPadding)>2&&(o-=2),o>a&&(o=a),n=0!=(32&r)?t.holder.nextState.top-o:0!=(8&r)?t.holder.nextState.top+t.holder.nextState.height+o-t.sticker.nextState.naturalHeight:t.holder.nextState.top+t.holder.nextState.height/2-t.sticker.nextState.naturalHeight/2}else n=0!=(32&r)?t.holder.nextState.top:0!=(8&r)?t.holder.nextState.top+t.holder.nextState.height-t.sticker.nextState.naturalHeight:t.holder.nextState.top+t.holder.nextState.height/2-t.sticker.nextState.naturalHeight/2;t.sticker.positionConfig.stickyFloat?(a=t.sticker.nextState.naturalWidth/2,(o=Math.max(t.sticker.getParent().positionConfig.groupConfig.innerPadding,t.sticker.getParent().positionConfig.groupConfig.elementsPadding)+t.sticker.getParent().positionConfig.groupConfig.elementsPadding)>2&&(o-=2),o>a&&(o=a),i=0!=(4&r)?t.holder.nextState.left-o:0!=(1&r)?t.holder.nextState.left+t.holder.nextState.width+o-t.sticker.nextState.naturalWidth:t.holder.nextState.left+t.holder.nextState.width/2-t.sticker.nextState.naturalWidth/2):i=0!=(4&r)?t.holder.nextState.left:0!=(1&r)?t.holder.nextState.left+t.holder.nextState.width-t.sticker.nextState.naturalWidth:t.holder.nextState.left+t.holder.nextState.width/2-t.sticker.nextState.naturalWidth/2,t.sticker.setNextState({left:i,top:n,width:t.sticker.nextState.naturalWidth,height:t.sticker.nextState.naturalHeight,transition:"left 0.3s, top 0.3s, width 0.3s, height 0.3s, max-width 0.3s, min-width 0.3s, max-height 0.3s, min-height 0.3s",zIndex:10*e+(t.sticker.positionConfig.stickyBehind?-1:1)}),t.sticker.positionConfig.stickyAuto&&(t.sticker.renderer.setStyle(t.sticker.getWrapperDom(),"display","none"),0===t.holder.positionConfig.autoStickers.length&&(t.holder.positionConfig.sickerListeners||(t.holder.listenEvent("mouseenter"),t.holder.listenEvent("mouseleave"),t.holder.positionConfig.sickerListeners=!0)),t.holder.positionConfig.autoStickers.push(t.sticker),t.sticker.positionConfig.sickerListeners||(t.sticker.listenEvent("mouseenter"),t.sticker.listenEvent("mouseleave"),t.sticker.positionConfig.sickerListeners=!0))})}).bind(this)(),(function(){c.forEach(function(t){t.positionConfig.expansion&&1|t.positionConfig.expansion&&t.setNextState({width:t.nextState.width+l}),t.commitState()})}).bind(this)(),y.bind(this)(),void(function(){if(t!==this.rootEl){if(t.positionConfig.selfSized){var e=0,n=0;c.length&&(c.forEach(function(t){n=Math.max(n,t.nextState.top+t.nextState.height),e=Math.max(e,t.nextState.left+t.nextState.width-(1&t.positionConfig.expansion?l:0))}),n+=l+s,e+=l+s),e=Math.max(e,t.nextState.naturalWidth),n=Math.max(n,t.nextState.naturalHeight),1&t.positionConfig.expansion&&(e-=t.getParent().positionConfig.groupConfig.elementsPadding),t.setNextState({naturalWidth:e,naturalHeight:n,width:e,height:n})}t.redraw()}}).bind(this)();function y(){var t=this;c.forEach(function(n){"group"===n.getType()&&(n.positionConfig.selfSized||(n.setNextState({naturalWidth:n.nextState.width,naturalHeight:n.nextState.height}),t.recalculateLayoutHelper(n,e,0)))})}function C(){g<0?(r=s,a=s):(a=s,r+=x(d[g])),g++,d.push([])}function x(t){var e=0;return t.forEach(function(t){t.nextState.height>e&&(e=t.nextState.height)}),e+2*l}function S(t){var e=2*s;return t.forEach(function(t){return e+=t.nextState.width+2*l}),e}function b(t,e){var n=2*s;return e.forEach(function(i){return n+=E(t,e,i)+2*l}),n}function E(t,e,n){if(0===n.positionConfig.fillX)return n.nextState.width;if(""!==n.positionConfig.clone){var i=void 0;for(i=0;i<e.length&&e[i].getId()!==n.positionConfig.clone;i++);if(i===e.length)return p[n.positionConfig.clone].nextState.width}var o=n.positionConfig.fillX*t/100-2*l;return o<n.nextState.width&&(o=n.nextState.width),Math.min(-1===n.positionConfig.maxW?o:n.positionConfig.maxW,o)}function w(t){for(var e=2*s,n=0;n<d.length;n++)e+=D(t,n)+2*l;return e}function D(t,e){var n=0;return d[e].forEach(function(e){var i;if(0!==e.positionConfig.fillY){var o=e.positionConfig.fillY*t/100;o<e.nextState.height&&(o=e.nextState.height),i=Math.min(-1===e.positionConfig.maxH?o:e.positionConfig.maxH,o)}else i=e.nextState.height;i>n&&(n=i)}),n}},t.prototype.initEl=function(t,e,n){var i,o=this;void 0===e&&(e=!1),void 0===n&&(n=!1);var r=0,s=0;t.getScrolledDom()&&(r=t.getScrolledDom().scrollTop,s=t.getScrolledDom().scrollLeft);var l=null===(i=t.positionConfig)||void 0===i?void 0:i.calculated;t.setupConfig(),t.positionConfig.calculated=Object(a.isNil)(l)?t.positionConfig.calculated:l;var p=t.positionConfig;e&&(p.calculated=3);var d=t.calculateNaturalSize();if(void 0!==d){if(t.setNextState({naturalWidth:d.width,naturalHeight:d.height,renderedContentWidth:d.width,renderedContentHeight:d.height,width:d.width,height:d.height,transition:1!==p.calculated&&2!==p.calculated||n?this.transitionNone:this.transition}),p.hidden?t.renderer.setStyle(t.getWrapperDom(),"display","none"):t.renderer.removeStyle(t.getWrapperDom(),"display"),t!==this.rootEl&&!a.isNil(p))switch(t.getParent().positionConfig.construction){case"absolute":t.setNextState({zIndex:1,left:p.x,top:p.y,width:p.w,height:p.h,opacity:1}),t.commitState();break;default:t.setNextState({zIndex:1,width:d.width,height:d.height,opacity:1})}var h=t.getChildren();if(h&&Object.values(h).forEach(function(t){return o.initEl(t,e,n)}),t===this.rootEl&&(this.isDragging||this.recalculateLayout(t.getWrapperDom().offsetWidth,t.getWrapperDom().offsetHeight),this.maintenanceActivated||(this.maintenanceActivated=!0,this.timeouts.push(setTimeout(function(){return o.maintenance()},this.maintenanceFrequency)))),t.getScrolledDom()){t.getScrolledDom();var u=t.getScrolledDom().style["scroll-behavior"];this.layoutController.renderer.setStyle(t.getScrolledDom(),"scroll-behavior","auto"),t.getScrolledDom().scrollTop=r,t.getScrolledDom().scrollLeft=s,this.layoutController.renderer.setStyle(t.getScrolledDom(),"scroll-behavior",u)}}},t.prototype.maintenance=function(){var t=this;this.isDragging||(this.maintenanceCounter++,this.maintenanceHelperRoot(),this.maintenanceHelperTables(this.rootEl)),this.timeouts.push(setTimeout(function(){return t.maintenance()},this.maintenanceFrequency))},t.prototype.maintenanceHelperRoot=function(){this.rootEl.activeState.width!=this.rootEl.getWrapperDom().offsetWidth||this.rootEl.activeState.height!=this.rootEl.getWrapperDom().offsetHeight?(this.maintenanceRootSizeMismatch++,3==this.maintenanceRootSizeMismatch&&(this.recalculateLayout(this.rootEl.getWrapperDom().offsetWidth,this.rootEl.getWrapperDom().offsetHeight),this.maintenanceRootSizeMismatch=0)):this.maintenanceRootSizeMismatch=0},t.prototype.maintenanceHelperTables=function(t){var e=this;if(this.maintenanceCounter%3==0){"table"===t.getType()&&t.getWrapper().redraw$.next();var n=t.getChildren();n&&Object.values(n).forEach(function(t){return e.maintenanceHelperTables(t)})}},t.prototype.onGroupScroll=function(t){t.getScrolledDom(),this.layoutController.getControl()&&this.layoutController.getControl().update()},t.prototype.onUpdate=function(t,e,n,i){this.initEl(this.rootEl)},t.prototype.onElementEvent=function(t,e,n){var i=this;switch(e){case"mouseenter":this.activeElements.includes(t)||this.activeElements.push(t),this.timeouts.push(setTimeout(function(){var e=i.activeElements.includes(t);t.positionConfig.autoStickers.forEach(function(t){e=e||i.activeElements.includes(t)}),e&&t.positionConfig.autoStickers.forEach(function(t){t.renderer.removeStyle(t.getWrapperDom(),"display")})},300));break;case"mouseleave":var o=this.activeElements.indexOf(t);o>=0&&this.activeElements.splice(o,1),t.positionConfig.autoStickers.length>0&&this.timeouts.push(setTimeout(function(){return i.hideAutoStickers(t)},150)),void 0!==t.positionConfig.stickerHolder&&this.timeouts.push(setTimeout(function(){return i.hideAutoStickers(t.positionConfig.stickerHolder)},150))}},t.prototype.onElementDestroy=function(t){var e=this.activeElements.indexOf(t);e>=0&&this.activeElements.splice(e,1)},t.prototype.hideAutoStickers=function(t){var e=this;if(!this.activeElements.includes(t)){var n=!1;t.positionConfig.autoStickers.forEach(function(t){n=n||e.activeElements.includes(t)}),(n=n||this.isDragging)||t.positionConfig.autoStickers.forEach(function(t){t.renderer.setStyle(t.getWrapperDom(),"display","none")})}},t.prototype.onElementSizeChanged=function(t,e){if(this.elementSizeChanged$.next({el:t,size:e}),Object(a.isNil)(e)){t.positionConfig.calculated=3;var n=t.calculateNaturalSize();e={width:n.width,height:n.height}}if(1===t.positionConfig.calculated)return t.positionConfig.lastKnownSizeW=e.width,t.positionConfig.lastKnownSizeH=e.height,void(t.positionConfig.calculated=2);if(t.positionConfig.lastKnownSizeW!==e.width||t.positionConfig.lastKnownSizeH!==e.height){if(t.positionConfig.calculated=3,t.positionConfig.lastKnownSizeW=e.width,t.positionConfig.lastKnownSizeH=e.height,t!==this.rootEl&&"group"===t.getType())return;var i=t.calculateNaturalSize();if(null==i)return;t.setNextState({naturalWidth:i.width,naturalHeight:i.height,renderedContentWidth:i.width,renderedContentHeight:i.height,width:i.width,height:i.height}),this.recalculateLayout(this.rootEl.getWrapperDom().offsetWidth,this.rootEl.getWrapperDom().offsetHeight)}},t.prototype.getMousePosition=function(t){var e=t.getLocalMousePosition();return{x:e.x+t.getScrolledDom().scrollLeft,y:e.y+t.getScrolledDom().scrollTop}},t.prototype.getIndexForMousePosition=function(t,e,n){var i,o,r,a;if(0==e.length)return{index:0,isBefore:!0};var s,l=this.getMousePosition(t);if("column"===(null===(o=null===(i=null==t?void 0:t.getLayout())||void 0===i?void 0:i.dropzone)||void 0===o?void 0:o.arrangement))for(s=e.length-1;s>=0&&((null===(r=(p=e[s]).getLayout())||void 0===r?void 0:r.dragFooter)||!(l.y>(d=p.activeState).top+d.height/2));s--);else for(s=e.length-1;s>=0;s--){var p,d;if(!(null===(a=(p=e[s]).getLayout())||void 0===a?void 0:a.dragFooter)&&(l.y>(d=p.activeState).top+d.height||l.y>=d.top&&l.x>=d.left+d.width/2))break}return-1==s||s<e.length-1&&n.getDragElement().getId()===e[s+1].getId()?{index:s+1,isBefore:!0}:{index:s,isBefore:!1}},t.prototype.onDragStart=function(t,e,n,i){var o,r;void 0===i&&(i=null),this.isDragging=!0;var s=null===(r=null===(o=t.getLayout())||void 0===o?void 0:o.draggable)||void 0===r?void 0:r.type;i&&(s=i),this.dragStart$.next({el:t,data:e,control:n}),n.show();var l=this.tempElements[t.getId()+"__dragStartPos"];l&&(l.destroy(),delete this.tempElements[t.getId()+"__dragStartPos"]);var p=t.getDragElement();this.tempElements[t.getId()+"__dragStartPos"]=this.layoutController.createTempEl(p.nextState,{"background-color":"rgba(var(--theme-primary-500),0.2)",border:"0px dotted rgba(var(--theme-primary-500),0.2)"},p.getParent(),"clone"===s?p:null,"clone"===s?{opacity:.5}:null);var d=this.layoutController.getPositionDiff(p,this.rootEl);this.layoutController.moveVisuallyToGroup(p,this.rootEl),p.setNextState({left:p.nextState.left+d.left,top:p.nextState.top+d.top,transition:this.transitionNone,opacity:.5}),p.dragStartState=Object(a.cloneDeep)(p.nextState),p.updateState(),n.applyBgStyle({cursor:"grabbing"})},t.prototype.onDrag=function(t,e,n,i){var o;void 0===i&&(i=null),this.layoutController.dragDisabled=!0;var r=this.determineTargetGroup(t,this.layoutController.mousePos.x,this.layoutController.mousePos.y),a=t.getDragElement(),s=null===(o=null==t?void 0:t.getParent())||void 0===o?void 0:o.getScrolledDom();if(s){var l=s.getBoundingClientRect(),p=e.mouseX-l.left,d=e.mouseY-l.top,h=0,u=0;d<20?u=-10:d>l.height-20&&(u=10),p<20?h=-10:p>l.width-20&&(h=10),this.scrollController.setScrollSpeed(s,h,u)}"absolute"===a.getParent().positionConfig.construction?this.onDragAbsolute(t,e,n,i,r):this.onDragScript(t,e,n,i,r)},t.prototype.onDragAbsolute=function(t,e,n,i,o){void 0===i&&(i=null);var r=t.getDragElement();o=r.getParent();var a=this.calculateDragPos(r,o,e),s=this.tempElements[t.getId()+"__dragStartPos"],l=this.canDropAbsolute(t,a,o,e);l?(this.layoutController.renderer.removeClass(n.elRef.nativeElement,"cantDrop"),n.applyBgStyle({cursor:"grabbing"}),s.applyStyles({"background-color":"rgba(var(--theme-primary-500),0.2)","border-color":"rgba(var(--theme-primary-500),0.2)","border-style":"dotted","background-image":"none","border-radius":"3px"})):(this.layoutController.renderer.addClass(n.elRef.nativeElement,"cantDrop"),n.applyBgStyle({cursor:"no-drop"}),s.applyStyles({"background-color":"rgba(var(--theme-warn-500),0.5)","border-color":"rgba(var(--theme-warn-500),1)","border-style":"solid","background-image":"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(var(--theme-warn-500),0.5) 5px, rgba(var(--theme-warn-500),0.5) 10px)"})),this.dragTempData.prevCanDrop=l,r.setNextState({left:a.x0,top:a.y0,opacity:l?.5:.2,transition:"none"}),r.updateState()},t.prototype.calculateDragPos=function(t,e,n){var i=this.getElementRect(e),o=(i.x1-i.x0)/1e3,r=(i.y1-i.y0)/1e3,a=t.dragStartState.left+n.deltaX,s=a+t.getLayout().w*o,l=t.dragStartState.top+n.deltaY,p=l+t.getLayout().h*r;return a<i.x0?(s=s+i.x0-a,a=i.x0):s>i.x1&&(a=a+i.x1-s,s=i.x1),l<i.y0?(p=p+i.y0-l,l=i.y0):p>i.y1&&(l=l+i.y1-p,p=i.y1),{x0:a,y0:l,x1:s,y1:p}},t.prototype.canDropAbsolute=function(t,e,n,i){var o=this.getSortedElementList(n,0),r=n.nextState.left,a=n.nextState.top;return!(e.x0<r||e.x1>r+n.nextState.width||e.y0<a||e.y1>a+n.nextState.height)&&function(){for(var n=0,i=o;n<i.length;n++){var s=i[n];if(s!==t){var l=s.nextState.left+r,p=s.nextState.top+a;if(e.x0<l+s.nextState.width&&l<e.x1&&e.y0<p+s.nextState.height&&p<e.y1)return!1}}return!0}()},t.prototype.onDragScript=function(t,e,n,i,o){void 0===i&&(i=null);var r,a,s=this.tempElements[t.getId()+"__dragStartPos"];o!==this.dragTempData.prevTargetGroup?(a=this.dragTempData.tempTargetSortedChildren=this.getSortedElementList(o,0),(r=this.dragTempData.prevCanDrop=this.canBeDropped(t,o))?(this.layoutController.renderer.removeClass(n.elRef.nativeElement,"cantDrop"),n.applyBgStyle({cursor:"grabbing"}),s.applyStyles({"background-color":"rgba(var(--theme-primary-500),0.2)","border-color":"rgba(var(--theme-primary-500),0.2)","border-style":"dotted","background-image":"none","border-radius":"3px"})):(this.layoutController.renderer.addClass(n.elRef.nativeElement,"cantDrop"),n.applyBgStyle({cursor:"no-drop"}),s.applyStyles({"background-color":"rgba(var(--theme-warn-500),0.5)","border-color":"rgba(var(--theme-warn-500),1)","border-style":"solid","background-image":"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(var(--theme-warn-500),0.5) 5px, rgba(var(--theme-warn-500),0.5) 10px)"})),this.dragTempData.prevCanDrop=r):(a=this.dragTempData.tempTargetSortedChildren,r=this.dragTempData.prevCanDrop);var l=this.getIndexForMousePosition(o,a,t);this.layoutController.updateDropIndicator(o,a[l.index],l.isBefore,s,r,t);var p=t.getDragElement();p.setNextState({left:p.dragStartState.left+e.deltaX,top:p.dragStartState.top+e.deltaY,opacity:r?.5:.2,transition:"none"}),p.updateState()},t.prototype.onDragEnd=function(t,e,n,i){void 0===i&&(i=null),this.isDragging=!1,"absolute"===t.getParent().positionConfig.construction?this.onDragEndAbsolute(t,e,n,i):this.onDragEndScript(t,e,n,i),this.dragTempData={},e.deltaX=0,e.deltaY=0,this.scrollController.stopScroll()},t.prototype.onDragEndAbsolute=function(t,e,n,i){var o,r,a=this;void 0===i&&(i=null),this.dragEnd$.next({el:t,data:e,control:n});var s=t.getDragElement(),l=s.getParent(),p=this.calculateDragPos(s,l,e),d=this.canDropAbsolute(t,p,l,e),h=null===(r=null===(o=t.getLayout())||void 0===o?void 0:o.draggable)||void 0===r?void 0:r.type;if(this.destroyDragStartTempElement(t.getId(),n),d){var u=this.getElementRect(l),c=(u.x1-u.x0)/1e3,g=(u.y1-u.y0)/1e3;t.getLayout().x=(p.x0-l.nextState.left)/c,t.getLayout().y=(p.y0-l.nextState.top)/g,i&&(h=i);var f=this.layoutController.getRelativePos(s,l);s.setNextState({left:f.left,top:f.top,opacity:s.dragStartState.opacity,transition:this.transition}),this.layoutController.moveToGroup(s,l,t.getDragElement().getLayout().index,h),s.commitState(),this.initEl(this.rootEl,!0),this.timeouts.push(setTimeout(function(){a.layoutController.dragDisabled=!1},this.dragTimeout))}else s.setNextState({left:s.dragStartState.left,top:s.dragStartState.top,opacity:s.dragStartState.opacity,transition:this.transition}),s.updateState(),this.timeouts.push(setTimeout(function(){s.resetState(),a.layoutController.moveVisuallyToGroup(s,s.getParent()),a.initEl(a.rootEl,!0),a.layoutController.dragDisabled=!1,a.isDragging=!1},this.dragTimeout))},t.prototype.onDragEndScript=function(t,e,n,i){var o,r,a=this;void 0===i&&(i=null),this.dragEnd$.next({el:t,data:e,control:n});var s=this.determineTargetGroup(t,this.layoutController.mousePos.x,this.layoutController.mousePos.y),l=null===(r=null===(o=t.getLayout())||void 0===o?void 0:o.draggable)||void 0===r?void 0:r.type;i&&(l=i);var p=this.tempElements[t.getId()+"__dragStartPos"],d=t.getDragElement();if(this.canBeDropped(t,s)&&"clone"!==l&&"fake"!==l){var h=this.layoutController.getRelativePos(d,s);d.setNextState({left:h.left,top:h.top,opacity:d.dragStartState.opacity,transition:this.transition});var u=this.getSortedElementList(s,0),c=this.getIndexForMousePosition(s,u,t);this.layoutController.moveToGroup(d,s,c.index+(c.isBefore?0:1),l),d.commitState(),p.destroy(),n.hide(),delete this.tempElements[t.getId()+"__dragStartPos"],this.initEl(this.rootEl,!0),this.timeouts.push(setTimeout(function(){n.update(),a.layoutController.dragDisabled=!1},this.dragTimeout))}else{n.hide();var g=function(){p&&(p.destroy(),delete a.tempElements[t.getId()+"__dragStartPos"]),d.resetState(),n.update(),n.hide(),a.layoutController.moveVisuallyToGroup(d,d.getParent())};!this.canBeDropped(t,s)||"clone"!==l&&"fake"!==l?(d.setNextState({left:d.dragStartState.left,top:d.dragStartState.top,opacity:d.dragStartState.opacity,transition:this.transition}),d.updateState()):(u=this.getSortedElementList(s,0),c=this.getIndexForMousePosition(s,u,t),this.layoutController.moveToGroup(d,s,c.index,l),g()),this.timeouts.push(setTimeout(function(){g(),a.initEl(a.rootEl,!0),a.layoutController.dragDisabled=!1,a.isDragging=!1},this.dragTimeout))}},t.prototype.onScaleStart=function(t,e,n){this.isDragging=!0},t.prototype.onScale=function(t,e,n){t.setNextState({width:t.activeState.width+e.deltaX,height:t.activeState.height+e.deltaY,transition:"none"}),t.updateState(),n.update()},t.prototype.onScaleEnd=function(t,e,n){this.isDragging=!1,t.getConfig().layout.w=t.activeState.width+e.deltaX,t.getConfig().layout.h=t.activeState.height+e.deltaY,t.commitState(),this.initEl(this.rootEl,!0)},t.prototype.canBeDropped=function(t,e){var n,i,o,r,a,s,l,p,d=e.getLayout(),h=t.getLayout();if((null===(i=null===(n=null==d?void 0:d.dropzone)||void 0===n?void 0:n.acceptKeys)||void 0===i?void 0:i.indexOf("*"))>=0||(null===(r=null===(o=null==h?void 0:h.draggable)||void 0===o?void 0:o.hasKeys)||void 0===r?void 0:r.indexOf("*"))>=0)return!0;if(null===(a=null==d?void 0:d.dropzone)||void 0===a?void 0:a.acceptKeys){if(null===(s=null==h?void 0:h.draggable)||void 0===s?void 0:s.hasKeys){for(var u=0,c=null===(l=h.draggable)||void 0===l?void 0:l.hasKeys;u<c.length;u++)if((null===(p=d.dropzone)||void 0===p?void 0:p.acceptKeys.indexOf(c[u]))>=0)return!0;return!1}return!1}return!1},t.prototype.determineTargetGroup=function(t,e,n){return this.findGroupAtPos(t,this.rootEl,e,n)||this.rootEl},t.prototype.findGroupAtPos=function(t,e,n,i){if("group"!==e.getType())return null;var o=e.getChildren();if(o)for(var r=void 0,a=Object.keys(o),s=0;s<a.length;s++)if(r=this.findGroupAtPos(t,o[a[s]],n,i))return r;var l=e.getWrapperDom().getBoundingClientRect();if(n>l.left&&n<l.left+l.width&&i>l.top&&i<l.top+l.height&&e!==t)try{for(var p=0,d=t.getLayout().draggable.hasKeys;p<d.length;p++){var h=d[p];if(e.getLayout().dropzone.acceptKeys.indexOf(h)>=0)return e}}catch(u){return null}return null},t.prototype.destroy=function(){var t=this;this.unlistenLoadingDone&&this.unlistenLoadingDone(),this.destroy$.next(),this.timeouts.forEach(function(t){clearTimeout(t)}),Object.keys(this.tempElements).forEach(function(e){t.tempElements[e].destroy()})},t.prototype.destroyDragStartTempElement=function(t,e){var n=t+"__dragStartPos",i=this.tempElements[n];i&&(i.destroy(),delete this.tempElements[n]),this.dragTempData={},e.hide(),e.update()},t.prototype.getElementRect=function(t){var e=t.nextState.left,n=t.nextState.top;return{x0:e,y0:n,x1:e+t.nextState.width,y1:n+t.nextState.height}},t}(),C=function(){function t(t){this.rootEl=t,this.dragDisabled=!1,this.activeElementEngaged=!1,this.controlsDestroyed$=new p.Subject,this.destroy$=new p.Subject,this.mousePos={x:0,y:0}}return t.prototype.init=function(){var t=this;this.renderer=this.rootEl.renderer,this.cfr=this.rootEl.el.cfr,this.rootGroup=this.rootEl.el.pluginComponentRef.instance,this.rootVC=this.rootGroup.targetVC,this.mouseMoveListener=this.renderer.listen(window,"mousemove",function(e){t.mousePos.x=e.clientX,t.mousePos.y=e.clientY}),this.positionController=new y(this.rootEl,this),this.rootEl.init(this),this.positionController.init()},t.prototype.getControl=function(){var t;return null===(t=this.controls)||void 0===t?void 0:t.instance},t.prototype.onUpdate=function(t,e,n,i){this.rootEl.update(this),this.positionController.onUpdate(t,e,n,i)},t.prototype.activate=function(t){var e,n;this.activeEl&&this.activeEl===t||(this.activeEl=t,this.createControls(),t.control=this.controls.instance,!0===(null===(n=null===(e=t.getLayout())||void 0===e?void 0:e.draggable)||void 0===n?void 0:n.parentDrag)?(this.setControlPos(t.getDragElement()),this.controls.instance.setSize({width:t.getDragElement().activeState.width,height:t.getDragElement().activeState.height})):(this.setControlPos(t),this.controls.instance.setSize({width:t.activeState.width,height:t.activeState.height})))},t.prototype.deactivate=function(t){void 0===t&&(t=null),t!==this.activeEl&&null!==t||(this.activeElementEngaged=!1,this.activeEl=null,t&&(t.control=null),this.destroyControls())},t.prototype.updateControl=function(){if(this.activeEl){var t=this.activeEl.getDragElement();this.setControlPos(t),this.setControlSize({width:t.nextState.width,height:t.nextState.height})}},t.prototype.setControlPos=function(t){var e,n;if(this.controls){var i=this.getRelativePos(t,this.rootEl);i.left+=this.controls.location.nativeElement.parentElement.scrollLeft,i.top+=this.controls.location.nativeElement.parentElement.scrollTop,(null===(n=null===(e=t.getLayout())||void 0===e?void 0:e.draggable)||void 0===n?void 0:n.parentDrag)&&(i.left-=t.activeState.left,i.top-=t.activeState.top),this.controls.instance.setPos({top:i.top,left:i.left})}},t.prototype.setControlSize=function(t){this.controls.instance.setSize({width:t.width,height:t.height})},t.prototype.getRelativePos=function(t,e){var n=t.getWrapperDom().getBoundingClientRect(),i=e.el.pluginComponentRef.instance.wrapperEl.nativeElement,o=i.getBoundingClientRect();return{top:n.top-o.top+i.scrollTop,left:n.left-o.left+i.scrollLeft}},t.prototype.getLocalPosition=function(t,e){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{top:n.top-i.top,left:n.left-i.left,bottom:n.bottom-i.top,right:n.right-i.left}},t.prototype.createDropIndicator=function(){this.dropIndicator=this.renderer.createElement("div");var t=this.rootGroup.wrapperEl.nativeElement;this.renderer.setStyle(this.dropIndicator,"width","5px"),this.renderer.setStyle(this.dropIndicator,"height","30px"),this.renderer.setStyle(this.dropIndicator,"border-radius","30px"),this.renderer.setStyle(this.dropIndicator,"background","rgba(var(--theme-accent-500),0.5)"),this.renderer.setStyle(this.dropIndicator,"transform","translateX(-50%) translateY(-50%)"),this.renderer.setStyle(this.dropIndicator,"position","absolute"),this.renderer.setStyle(this.dropIndicator,"z-index","9999999999"),this.renderer.setStyle(this.dropIndicator,"display","none"),this.renderer.setStyle(this.dropIndicator,"pointer-events","none"),this.renderer.appendChild(t,this.dropIndicator)},t.prototype.updateDropIndicator=function(t,e,n,i,o,r){var s,l,p,d,h;if(void 0===n&&(n=!1),Object(a.isNil)(null===(s=t.getWrapper().pluginConfig.layout)||void 0===s?void 0:s.dropzone)||Object(a.isNil)(t.getWrapper().pluginConfig.layout.dropzone.order))if(e!=r.getDragElement()){var u=null===(p=null===(l=t.getConfig().config)||void 0===l?void 0:l.layoutConfig)||void 0===p?void 0:p.elementsPadding;if(u||(u=0),this.dropIndicator&&e&&o){var c=e.getWrapperDom();e===this.activeEl&&i&&(c=i.getWrapperDom());var g=(y=this.getLocalPosition(c,this.dropIndicator.parentElement)).right-y.left,f=y.bottom-y.top;this.renderer.setStyle(this.dropIndicator,"display","inline-block");var m=r.getDragElement();if("column"===(null===(d=t.getLayout().dropzone)||void 0===d?void 0:d.arrangement)){var v=Math.max(t.activeState.width-2*u,0);m.getWrapperDom().offsetWidth<v&&(v=m.getWrapperDom().offsetWidth),v<10&&(v=10),this.renderer.setStyle(this.dropIndicator,"width",v+"px"),this.renderer.setStyle(this.dropIndicator,"left",y.left+v/2+"px"),this.renderer.setStyle(this.dropIndicator,"top",y.top+(n?-u:f+u)+"px"),this.renderer.setStyle(this.dropIndicator,"height",(u>10?u:10)+"px")}else this.renderer.setStyle(this.dropIndicator,"width",(u>3?u:3)+"px"),this.renderer.setStyle(this.dropIndicator,"left",y.left+(n?-u:g+u)+"px"),this.renderer.setStyle(this.dropIndicator,"top",y.top+m.getWrapperDom().offsetHeight/2+"px"),this.renderer.setStyle(this.dropIndicator,"height",m.getWrapperDom().offsetHeight+"px")}else if(this.dropIndicator&&o){var y=this.getLocalPosition(t.getWrapperDom(),this.dropIndicator.parentElement);"column"===(null===(h=t.getLayout().dropzone)||void 0===h?void 0:h.arrangement)?(v=Math.max(t.activeState.naturalWidth-2*u,10),i.getWrapperDom().offsetWidth<v&&(v=i.getWrapperDom().offsetWidth),v<10&&(v=10),this.renderer.setStyle(this.dropIndicator,"display","inline-block"),this.renderer.setStyle(this.dropIndicator,"height",(u>10?u:10)+"px"),this.renderer.setStyle(this.dropIndicator,"left",y.left+u+v/2+"px"),this.renderer.setStyle(this.dropIndicator,"top",y.top+u+"px"),this.renderer.setStyle(this.dropIndicator,"width",v+"px")):(this.renderer.setStyle(this.dropIndicator,"display","inline-block"),this.renderer.setStyle(this.dropIndicator,"width",(u>3?u:3)+"px"),this.renderer.setStyle(this.dropIndicator,"left",y.left+u+"px"),this.renderer.setStyle(this.dropIndicator,"top",y.top+u+i.getWrapperDom().offsetHeight/2+"px"),this.renderer.setStyle(this.dropIndicator,"height",i.getWrapperDom().offsetHeight+"px"))}else this.renderer.setStyle(this.dropIndicator,"display","none")}else this.renderer.setStyle(this.dropIndicator,"display","none");else this.renderer.setStyle(this.dropIndicator,"display","none")},t.prototype.destroyDropIndicator=function(){this.dropIndicator&&this.renderer.removeChild(this.dropIndicator.parentElement,this.dropIndicator),this.dropIndicator=null},t.prototype.getNearestEditButtons=function(t){var e,n,i,o,r=null===(o=null===(i=null===(n=null===(e=t.getParentContext())||void 0===e?void 0:e.pluginConfig)||void 0===n?void 0:n.config)||void 0===i?void 0:i.layoutConfig)||void 0===o?void 0:o.editButtons;return!r&&t!==t.getRoot()&&t.getParent()&&(r=this.getNearestEditButtons(t.getParent())),r},t.prototype.checkForDisabledEditButtons=function(t){var e,n,i,o,r=!Object(a.isNil)(null===(o=null===(i=null===(n=null===(e=t.getParentContext())||void 0===e?void 0:e.pluginConfig)||void 0===n?void 0:n.config)||void 0===i?void 0:i.layoutConfig)||void 0===o?void 0:o.disableEditButtons);return!r&&t!==t.getRoot()&&t.getParent()&&(r=this.checkForDisabledEditButtons(t.getParent())),r},t.prototype.createControls=function(){var t,e,n,i,o=this,r=this.cfr.resolveComponentFactory(m);this.controls&&this.destroyControls();var s=this.rootGroup.targetVC.createComponent(r,void 0,this.rootEl.el.injector);s.instance.wrapperEl=this.rootGroup.wrapperEl,s.instance.draggable=null===(t=this.activeEl.getLayout())||void 0===t?void 0:t.draggable,s.instance.hideControls=!!Object(a.isNil)(null===(e=this.activeEl.getLayout())||void 0===e?void 0:e.hideControls)||(null===(n=this.activeEl.getLayout())||void 0===n?void 0:n.hideControls),s.instance.layoutController=this;var l=this.activeEl.getConfig().layout;this.checkForDisabledEditButtons(this.activeEl)||(s.instance.editButtons=(null===(i=l.draggable)||void 0===i?void 0:i.editButtons)?l.draggable.editButtons:this.getNearestEditButtons(this.activeEl));var p=this.activeEl;this.subscribeToElementControlEvent(s.instance.dragStart$,function(t){var e;p.isDragging=!0,o.activeElementEngaged=!0,o.positionController.onDragStart(p,t.data,o.controls.instance,null===(e=t.editButton)||void 0===e?void 0:e.supportDrag),o.setControlPos(p),o.renderer.setStyle(o.activeEl.getWrapperDom(),"pointer-events","none"),o.createDropIndicator()}),this.subscribeToElementControlEvent(s.instance.drag$,function(t){var e;p.isDragging=!0,o.positionController.onDrag(p,t.data,o.controls.instance,null===(e=t.editButton)||void 0===e?void 0:e.supportDrag),o.setControlPos(p)}),this.subscribeToElementControlEvent(s.instance.dragEnd$,function(t){var e;p.isDragging=!1,o.renderer.removeStyle(o.activeEl.getWrapperDom(),"pointer-events"),o.setControlPos(p),o.positionController.onDragEnd(p,t.data,o.controls.instance,null===(e=t.editButton)||void 0===e?void 0:e.supportDrag),o.activeElementEngaged=!1,o.destroyDropIndicator()}),this.subscribeToElementControlEvent(s.instance.scaleStart$,function(t){o.activeElementEngaged=!0,o.positionController.onScaleStart(p,t.data,o.controls.instance)}),this.subscribeToElementControlEvent(s.instance.scale$,function(t){o.positionController.onScale(p,t.data,o.controls.instance)}),this.subscribeToElementControlEvent(s.instance.scaleEnd$,function(t){o.activeElementEngaged=!1,o.positionController.onScaleEnd(p,t.data,o.controls.instance)}),this.subscribeToElementControlEvent(s.instance.buttonEvent$,function(t){var e={};e.path=o.activeEl.getWrapper().getPathString(),e.editButton=t.editButton,o.activeElementEngaged=!0,o.activeEl.getParent().getPlugin().instance.editButtonEvent$.next(e)}),this.subscribeToElementControlEvent(s.instance.mouseLeave$,function(t){p.handleMouseLeave()}),this.controls=s},t.prototype.destroyControls=function(){this.destroyDropIndicator(),this.controls&&(this.controlsDestroyed$.next(),this.controls.destroy(),this.controls=null)},t.prototype.moveToGroup=function(t,e,n,i){if("group"!==e.getConfig().type)return console.error("Can't move to group since targetEl is not a group ",t.getId(),e.getId());t.getParent()===e&&"clone"!==i&&this.positionController.getSortedElementList(e,0).indexOf(t)<n&&(n-=1),("move"===i||Object(a.isNil)(i))&&t.getParentContext().pluginComponentRef.instance.detachPlugin(this.activeEl.getDragElement().getId());var o=t.getWrapper().getPathString();e.el.pluginComponentRef.instance.attachPlugin(this.activeEl.getDragElement().getId(),this.activeEl.getDragElement(),n,o,i)},t.prototype.getPositionDiff=function(t,e){var n=e.el.pluginComponentRef.instance,i=t.getWrapperDom().parentElement.getBoundingClientRect(),o=t.getWrapperDom().parentElement,r=n.targetVC.element.nativeElement.parentElement,a=r.getBoundingClientRect();return{left:i.left-a.left-o.scrollLeft+r.scrollLeft,top:i.top-a.top-o.scrollTop+r.scrollTop}},t.prototype.moveVisuallyToGroup=function(t,e){var n=e.el.pluginComponentRef.instance.targetVC,i=t.el.wrapperComponentRef.hostView,o=t.getParentVC().indexOf(i);o>=0&&(t.getParentVC().detach(o),n.insert(i),t.el.currentParentContext=e.el)},t.prototype.createTempEl=function(t,e,n,i,o){var r=this;void 0===n&&(n=this.rootEl),void 0===i&&(i=null),void 0===o&&(o=null);var s=this.cfr.resolveComponentFactory(n.el.pluginCreator.getPluginWrapperComponent()),l=n.getTargetVC().createComponent(s,void 0,n.el.injector),p=l.instance;if(p.wrapperComponentRef=l,i){var h=i.getWrapperDom().cloneNode(!0);this.renderer.appendChild(p.wrapperComponentRef.location.nativeElement,h),this.renderer.removeStyle(h,"left"),this.renderer.removeStyle(h,"top"),o&&Object.keys(o).forEach(function(t){r.renderer.setStyle(h,t,o[t])})}Object.assign({position:"absolute",styles:e});var u=new d(p);return u.setNextState(Object(a.cloneDeep)(t)),u.commitState(),u.applyStyles(e),u},t.prototype.moveToVC=function(t,e,n){var i=t.getWrapperDom().getBoundingClientRect(),o=n.element.nativeElement.parentElement.getBoundingClientRect(),r={top:i.top-o.top,left:i.left-o.left,width:i.width,height:i.height},a=t.el.wrapperComponentRef.hostView,s=e.indexOf(a);s>=0&&(e.detach(s),n.insert(a)),t.nextState.left=r.left,t.nextState.top=r.top,t.commitState()},t.prototype.findWrapperDivParent=function(t,e){var n,i=this,o=t.getChildren();return o&&Object.keys(o).forEach(function(t){var r=i.findWrapperDivParent(o[t],e);r&&(n=r)}),"group"===t.getConfig().type&&t.el.pluginComponentRef.instance.wrapperEl.nativeElement===e&&(n=t),n},t.prototype.destroy=function(){this.mouseMoveListener&&this.mouseMoveListener(),this.positionController&&this.positionController.destroy(),this.destroy$.next()},t.prototype.subscribeToElementControlEvent=function(t,e){t.pipe(Object(l.takeUntil)(this.controlsDestroyed$)).subscribe(e)},t}(),x=["targetVC"],S=["wrapperRef"];function b(t,e){}var E=function(){function t(t,e,n,i,o,r,a,s,l){this.cfr=t,this.injector=e,this.overlay=n,this.overlayContainer=i,this.renderer=o,this.elRef=r,this.hostVC=a,this.cd=s,this.context=l,this.children={},this.layoutElements={},this.elementAdded$=new p.Subject,this.elementRemoved$=new p.Subject,this.editButtonEvent$=new p.Subject,this.redraw=new p.Subject,this.counter=0,this.isBuilding=!1}return t.prototype.ngOnInit=function(){var t=this;this.createPluginWrappers(),this.context.update$.pipe(Object(l.takeUntil)(this.context.destroy$)).subscribe(function(e){t.pluginOnUpdate(e.prevConfig,e.newConfig,e.compareResult,e.commands,e.originalUpdate),t.layoutController&&t.layoutController.onUpdate(e.prevConfig,e.newConfig,e.compareResult,e.commands)}),this.elementAdded$.pipe(Object(l.takeUntil)(this.context.destroy$)).subscribe(function(e){t.context.firePluginInteractions("elementAdded",e).subscribe();var n=t.context.parentContext;n&&n!==t.context&&"group"===n.pluginConfig.type&&n.pluginComponentRef.instance.elementAdded$.next(e)}),this.elementRemoved$.pipe(Object(l.takeUntil)(this.context.destroy$)).subscribe(function(e){t.context.firePluginInteractions("elementRemoved",e).subscribe();var n=t.context.parentContext;n&&n!==t.context&&"group"===n.pluginConfig.type&&n.pluginComponentRef.instance.elementRemoved$.next(e)}),this.editButtonEvent$.pipe(Object(l.takeUntil)(this.context.destroy$)).subscribe(function(e){t.context.firePluginInteractions("editButtonEvent",e).subscribe();var n=t.context.parentContext;n&&n!==t.context&&"group"===n.pluginConfig.type&&n.pluginComponentRef.instance.editButtonEvent$.next(e)})},t.prototype.detachPlugin=function(t){this.context.control.removeControl(t);var e=this.children[t].currentParentContext.pluginComponentRef.instance.targetVC,n=e.indexOf(this.children[t].wrapperComponentRef.hostView);n>-1&&e.detach(n),this.children[t].parentContext=null,this.children[t].currentParentContext=null,delete this.children[t],delete this.layoutElements[t],delete this.context.pluginConfig.config.elements[t],this.elementRemoved$.next({removedElement:t})},t.prototype.attachPlugin=function(t,e,n,i,o){var r,s,l,p,d;if("fake"!==o){if(this.children[t]){var h=(t=t.split("*")[0])+"*"+this.counter++;console.warn("Child with same id already exists in group. id:",t,"group:",this.context.getPathString(),"Renaming to: ",h),t=h}Object(a.isNil)(this.context.pluginConfig.config)&&(this.context.pluginConfig.config={}),Object(a.isNil)(this.context.pluginConfig.config.elements)&&(this.context.pluginConfig.config.elements={});var u=null===(r=this.context.pluginConfig.layout.dropzone)||void 0===r?void 0:r.order;if(Object(a.isNil)(u)?this.reindex(n):n=e.getWrapper().pluginConfig.layout.draggable.zoneOrder[u],Object(a.isNil)(o)||"move"===o){this.children[t]=e.el,this.layoutElements[t]=e;var c=this.children[t].wrapperComponentRef.hostView;this.targetVC.indexOf(c)<0&&this.targetVC.insert(c),this.children[t].currentParentContext=this.context,this.children[t].parentContext=this.context,this.context.control.addControl(t,e.el.control),this.context.pluginConfig.config.elements[t]=e.el.pluginConfig;var g=null===(s=this.context.pluginConfig.layout)||void 0===s?void 0:s.addKey,f=null===(p=null===(l=e.getWrapper().pluginConfig.layout)||void 0===l?void 0:l.draggable)||void 0===p?void 0:p.hasKeys;Object(a.isNil)(g)||Object(a.isNil)(f)||f.includes(g)||f.push(g);var m=null===(d=this.context.pluginConfig.layout)||void 0===d?void 0:d.removeKey;Object(a.isNil)(m)||f.splice(f.indexOf(m),1)}else if("clone"===o){var v=Object(a.cloneDeep)(e.el.pluginConfig);this.children[t]=this.createPlugin(t,v,n),this.context.pluginConfig.config.elements[t]=v,this.layoutElements[t].init(this.layoutElement.getLayoutController());var y=this.layoutElement.getLayoutController().getRelativePos(e,this.layoutElement);this.layoutElements[t].setNextState(Object(a.cloneDeep)(e.nextState)),this.layoutElements[t].setNextState({top:y.top,left:y.left}),this.layoutElements[t].updateState(),this.layoutElements[t].positionConfig=Object(a.cloneDeep)(e.positionConfig)}var C=this.context.pluginConfig.config.elements[t].layout;C||(C=this.context.pluginConfig.config.elements[t].layout={}),C.index=n;var x=this.layoutElement.getLayoutController().positionController,S=this.layoutElement.getRoot();"clone"===o&&x.initEl(S)}this.elementAdded$.next({previousPath:i,currentPath:"fake"!==o?this.children[t].getPathString():"",addedElementId:t,type:Object(a.isNil)(o)?"move":o})},t.prototype.reindex=function(t){for(var e=this.context.rootContext.pluginComponentRef.instance.layoutController.positionController.getSortedElementList(this.layoutElement,0),n=0;n<e.length;n++){var i=n>=t?n+1:n;e[n].getLayout().index=i}},t.prototype.ngAfterViewInit=function(){this.context.rootContext===this.context&&(this.layoutElement=new d(this.context),this.layoutController=new C(this.layoutElement),this.layoutController.init())},t.prototype.addNew=function(){},t.prototype.sortWrappers=function(){for(var t,e=(t=this.children,Object.keys(t).sort(function(e,n){var i=t[e].pluginConfig,o=t[n].pluginConfig;if(i&&o&&void 0!==i.tabIndex&&void 0!==o.tabIndex){if(i.tabIndex<o.tabIndex)return-1;if(i.tabIndex>o.tabIndex)return 1}return 0})),n=0;n<e.length;n++){var i=this.children[e[n]].wrapperComponentRef.hostView,o=this.targetVC.indexOf(i);o!==n&&(this.targetVC.detach(o),this.targetVC.insert(i,n))}},t.prototype.pluginOnUpdate=function(t,e,n,i,o){var a=this;if(n.diff.config&&Object(r.getDiff)(t.config,e.config).elements){var s=Object(r.deepCompare)(t.config.elements,e.config.elements);Object.keys(s.deleted).forEach(function(t){a.deleteElement(t)}),Object.keys(s.new).forEach(function(t){a.createElement(t,e.config.elements[t])}),Object.keys(s.updated).forEach(function(t){var n,i,r=o.config.elements["@@merge"];r&&(i=r.find(function(t){return"destroy"===Object.keys(t)[0]})),i&&(null===(n=i.destroy)||void 0===n?void 0:n.indexOf(t))>-1?(a.deleteElement(t),a.createElement(t,e.config.elements[t])):a.children[t].updatePlugin(e.config.elements[t],o.config.elements[t])})}Object.keys(this.children).forEach(function(t){e.config.elements[t]=a.children[t].pluginConfig})},t.prototype.createElement=function(t,e){this.children[t]=this.createPlugin(t,e)},t.prototype.deleteElement=function(t){this.children[t].destroy(),this.layoutElements[t].destroy(),delete this.children[t],delete this.layoutElements[t]},t.prototype.createPluginWrappers=function(){var t=this.context.pluginConfig;t.config&&t.config.elements?this.createPlugins(t.config.elements):console.warn("Group type plugin does not have any child elements",this.context.id)},t.prototype.createPlugins=function(t){for(var e,n=(e=t,Object.keys(e).sort(function(t,n){var i=e[t],o=e[n];if(i&&o&&void 0!==i.tabIndex&&void 0!==o.tabIndex){if(i.tabIndex<o.tabIndex)return-1;if(i.tabIndex>o.tabIndex)return 1}return 0})),i=0;i<n.length;i++){var o=n[i];this.children[o]=this.createPlugin(o,t[o])}},t.prototype.createPlugin=function(t,e,n){var i;void 0===n&&(n=void 0);var o=this.cfr.resolveComponentFactory(this.context.pluginCreator.getPluginWrapperComponent()),r=(i=this.targetVC.createComponent(o,n,this.injector)).instance;return r.currentParentContext=this.context,r.pluginCreator=this.context.pluginCreator,r.pluginLoader=this.context.pluginLoader,r.parentContext=this.context,r.rootContext=this.context.rootContext,r.wrapperComponentRef=i,r.setPlugin(t,e),this.layoutElements[t]=new d(r),"group"===r.pluginConfig.type&&(r.pluginComponentRef.instance.layoutElement=this.layoutElements[t]),r},t.prototype.ngOnDestroy=function(){this.layoutController&&this.layoutController.destroy()},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.ComponentFactoryResolver),o["\u0275\u0275directiveInject"](o.Injector),o["\u0275\u0275directiveInject"](s.Overlay),o["\u0275\u0275directiveInject"](s.OverlayContainer),o["\u0275\u0275directiveInject"](o.Renderer2),o["\u0275\u0275directiveInject"](o.ElementRef),o["\u0275\u0275directiveInject"](o.ViewContainerRef),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](r.PLUGIN_CONTEXT))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-group"]],viewQuery:function(t,e){if(1&t&&(o["\u0275\u0275staticViewQuery"](x,!0,o.ViewContainerRef),o["\u0275\u0275staticViewQuery"](S,!0,o.ElementRef)),2&t){var n=void 0;o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.targetVC=n.first),o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.wrapperEl=n.first)}},hostVars:2,hostBindings:function(t,e){2&t&&o["\u0275\u0275classProp"]("building",e.isBuilding)},decls:5,vars:2,consts:[["admino-group-wrapper","","cdk-scrollable","",1,"wrapper",3,"ngStyle","cdkTrapFocus"],["wrapperVC","","wrapperRef",""],["targetVC",""]],template:function(t,e){1&t&&(o["\u0275\u0275elementStart"](0,"div",0,1),o["\u0275\u0275template"](3,b,0,0,"ng-template",null,2,o["\u0275\u0275templateRefExtractor"]),o["\u0275\u0275elementEnd"]()),2&t&&o["\u0275\u0275property"]("ngStyle",null==e.context.pluginConfig.config?null:e.context.pluginConfig.config.innerStyle)("cdkTrapFocus",null==e.context.pluginConfig.config?null:e.context.pluginConfig.config.trapFocus)},directives:[s.CdkScrollable,i.NgStyle,s.CdkTrapFocus],styles:['[_nghost-%COMP%]{display:inline-flex}[_nghost-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{overflow:auto;position:relative;scroll-behavior:smooth}[_nghost-%COMP%]  .limit-interaction, [_nghost-%COMP%]  .limit-interaction *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}[_nghost-%COMP%]  .edit-shadow{box-shadow:5px 5px 10px 10px rgba(0,0,0,.5)}[_nghost-%COMP%]  .adm-drop-zone{outline:4px solid rgba(var(--theme-accent-500),0)!important}[_nghost-%COMP%]  .adm-drop-zone:after{top:0;left:0;content:"";width:100%;height:100%;pointer-events:none;position:absolute;background-color:rgba(var(--theme-accent-500),.05);transition:opacity 1s;opacity:0}[_nghost-%COMP%]  .adm-drop-zone-active{outline:4px solid rgba(var(--theme-accent-500),.3)!important}[_nghost-%COMP%]  .adm-drop-zone-active:after{opacity:1;background-image:repeating-linear-gradient(45deg,transparent,transparent 5px,rgba(var(--theme-primary-500),.1) 0,rgba(var(--theme-primary-500),.1) 10px)}']}),t}(),w=function(t){var e=[];return t?(Object.keys(t).sort(function(e,n){var i=t[e],o=t[n];return i.index>o.index?1:i.index<o.index?-1:0}).forEach(function(n){e.push(t[n])}),e):e},D=n("MdUB");function k(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"button",6),o["\u0275\u0275listener"]("click",function(t){o["\u0275\u0275restoreView"](n);var e=o["\u0275\u0275nextContext"]();return e.onButtonEvent({event:t,editButton:e.button})}),o["\u0275\u0275elementStart"](1,"mat-icon"),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"](),r=o["\u0275\u0275reference"](5);o["\u0275\u0275property"]("matMenuTriggerFor",r)("matTooltip",i.button.tooltip)("matTooltipDisabled",i.dragActive),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"](i.button.icon)}}function P(t,e){if(1&t&&(o["\u0275\u0275elementStart"](0,"mat-icon"),o["\u0275\u0275text"](1),o["\u0275\u0275elementEnd"]()),2&t){var n=o["\u0275\u0275nextContext"](2);o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate"](n.button.icon)}}function O(t,e){if(1&t&&(o["\u0275\u0275elementStart"](0,"button",7),o["\u0275\u0275template"](1,P,2,1,"mat-icon",8),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"]()),2&t){var n=o["\u0275\u0275nextContext"](),i=o["\u0275\u0275reference"](5);o["\u0275\u0275property"]("matMenuTriggerFor",i)("matTooltip",n.button.tooltip)("matTooltipDisabled",n.dragActive),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",n.button.icon),o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate1"](" ",n.button.label,"\n")}}function W(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"button",9),o["\u0275\u0275listener"]("mousedown",function(t){o["\u0275\u0275restoreView"](n);var e=o["\u0275\u0275nextContext"]();return e.button.supportDrag?e.onButtonEvent({event:t,editButton:e.button}):null})("click",function(t){o["\u0275\u0275restoreView"](n);var e=o["\u0275\u0275nextContext"]();return e.button.supportDrag?null:e.onButtonEvent({event:t,editButton:e.button})}),o["\u0275\u0275elementStart"](1,"mat-icon"),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("matTooltip",i.button.tooltip)("matTooltipDisabled",i.dragActive),o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate"](i.button.icon)}}function M(t,e){if(1&t&&(o["\u0275\u0275elementStart"](0,"mat-icon"),o["\u0275\u0275text"](1),o["\u0275\u0275elementEnd"]()),2&t){var n=o["\u0275\u0275nextContext"](2);o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate"](n.button.icon)}}function I(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"button",10),o["\u0275\u0275listener"]("mousedown",function(t){o["\u0275\u0275restoreView"](n);var e=o["\u0275\u0275nextContext"]();return e.button.supportDrag?e.onButtonEvent({event:t,editButton:e.button}):null})("click",function(t){o["\u0275\u0275restoreView"](n);var e=o["\u0275\u0275nextContext"]();return e.button.supportDrag?null:e.onButtonEvent({event:t,editButton:e.button})}),o["\u0275\u0275template"](1,M,2,1,"mat-icon",8),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("matTooltip",i.button.tooltip)("matTooltipDisabled",i.dragActive),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",i.button.icon),o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate1"](" ",i.button.label,"\n")}}function R(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"app-layout-element-button",12),o["\u0275\u0275listener"]("buttonEvent",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"](2).onButtonEvent(t)}),o["\u0275\u0275elementEnd"]()}2&t&&o["\u0275\u0275property"]("button",e.$implicit)}function j(t,e){if(1&t&&o["\u0275\u0275template"](0,R,1,1,"app-layout-element-button",11),2&t){var n=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("ngForOf",n.getSubButtons(n.button.subButtons))}}var L=function(){function t(t){this.cd=t,this.buttonEvent=new o.EventEmitter}return t.prototype.ngOnInit=function(){},t.prototype.onButtonEvent=function(t){this.buttonEvent.emit(t)},t.prototype.getSubButtons=function(t){return w(t)},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.ChangeDetectorRef))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-layout-element-button"]],viewQuery:function(t,e){var n;1&t&&o["\u0275\u0275viewQuery"](D.MatMenuTrigger,!0),2&t&&o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.trigger=n.first)},inputs:{dragActive:"dragActive",button:"button"},outputs:{buttonEvent:"buttonEvent"},decls:7,vars:4,consts:[["mat-icon-button","",3,"matMenuTriggerFor","matTooltip","matTooltipDisabled","click",4,"ngIf"],["mat-button","",3,"matMenuTriggerFor","matTooltip","matTooltipDisabled",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matTooltipDisabled","mousedown","click",4,"ngIf"],["mat-button","",3,"matTooltip","matTooltipDisabled","mousedown","click",4,"ngIf"],["menu","matMenu"],["matMenuContent",""],["mat-icon-button","",3,"matMenuTriggerFor","matTooltip","matTooltipDisabled","click"],["mat-button","",3,"matMenuTriggerFor","matTooltip","matTooltipDisabled"],[4,"ngIf"],["mat-icon-button","",3,"matTooltip","matTooltipDisabled","mousedown","click"],["mat-button","",3,"matTooltip","matTooltipDisabled","mousedown","click"],["style","display: block; width: 100%;",3,"button","buttonEvent",4,"ngFor","ngForOf"],[2,"display","block","width","100%",3,"button","buttonEvent"]],template:function(t,e){1&t&&(o["\u0275\u0275template"](0,k,3,4,"button",0),o["\u0275\u0275template"](1,O,3,5,"button",1),o["\u0275\u0275template"](2,W,3,3,"button",2),o["\u0275\u0275template"](3,I,3,4,"button",3),o["\u0275\u0275elementStart"](4,"mat-menu",null,4),o["\u0275\u0275template"](6,j,1,1,"ng-template",5),o["\u0275\u0275elementEnd"]()),2&t&&(o["\u0275\u0275property"]("ngIf",!e.button.label&&e.button.subButtons),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",e.button.label&&e.button.subButtons),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",!e.button.label&&!e.button.subButtons),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",e.button.label&&!e.button.subButtons))},directives:[i.NgIf,D.MatMenu,D.MatMenuContent,D.MatButton,D.MatMenuTrigger,D.MatTooltip,D.MatIcon,i.NgForOf,t],styles:["[_nghost-%COMP%]{display:inline-block}[_nghost-%COMP%]  .mat-icon-button{font-size:18px;width:32px;height:32px;line-height:32px}[_nghost-%COMP%]  .mat-icon-button mat-icon{font-size:18px}[_nghost-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;text-align:left}"]}),t}();function T(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"app-layout-element-button",2),o["\u0275\u0275listener"]("buttonEvent",function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().onButtonEvent(t)}),o["\u0275\u0275elementEnd"]()}if(2&t){var i=e.$implicit,r=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("button",i)("dragActive",r.dragActive)}}var B=function(){function t(t){this.cd=t,this.buttonEvent=new o.EventEmitter}return Object.defineProperty(t.prototype,"editButtons",{get:function(){return this._editButtons},set:function(t){this._editButtons=t,this.processedButtons=w(t)},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.onButtonEvent=function(t){this.buttonEvent.emit(t)},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.ChangeDetectorRef))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-layout-element-button-controls"]],inputs:{dragActive:"dragActive",editButtons:"editButtons"},outputs:{buttonEvent:"buttonEvent"},decls:2,vars:1,consts:[[1,"button-container","mat-elevation-z5"],[3,"button","dragActive","buttonEvent",4,"ngFor","ngForOf"],[3,"button","dragActive","buttonEvent"]],template:function(t,e){1&t&&(o["\u0275\u0275elementStart"](0,"div",0),o["\u0275\u0275template"](1,T,1,2,"app-layout-element-button",1),o["\u0275\u0275elementEnd"]()),2&t&&(o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngForOf",e.processedButtons))},directives:[i.NgForOf,L],styles:[".button-container[_ngcontent-%COMP%]{background:rgba(var(--theme-background-400),.95);border-radius:50px;padding:3px;white-space:nowrap}"]}),t}(),N=function(){function t(){}return t.entry=E,t.\u0275mod=o["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.CommonModule,r.SharedModule,s.OverlayModule,D.MatTooltipModule,D.MatButtonModule,D.MatMenuModule,D.MatIconModule,s.A11yModule]]}),t}();o["\u0275\u0275setComponentScope"](m,[i.NgIf,B,i.NgClass,i.NgStyle],[]),e.default=N},Vgaj:function(t,e){t.exports=i},YLtl:function(t,e){t.exports=o},aP7H:function(t,e){t.exports=r},cfyg:function(t,e){t.exports=a},vOrQ:function(t,e){t.exports=s}})});