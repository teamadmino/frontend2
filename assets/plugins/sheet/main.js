!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("adm.@angular/common"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/platform-browser"),require("adm.@angular/core")):"function"==typeof define&&define.amd?define(["adm.@angular/common","adm.rxjs","adm.lodash","adm.rxjs/operators","adm.shared","adm.@angular/platform-browser","adm.@angular/core"],t):"object"==typeof exports?exports.sheet=t(require("adm.@angular/common"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/platform-browser"),require("adm.@angular/core")):e.sheet=t(e["adm.@angular/common"],e["adm.rxjs"],e["adm.lodash"],e["adm.rxjs/operators"],e["adm.shared"],e["adm.@angular/platform-browser"],e["adm.@angular/core"])}("undefined"!=typeof self?self:this,function(e,t,i,n,r,s,o){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,(function(t){return e[t]}).bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/assets/plugins/sheet",i(i.s=0)}({0:function(e,t,i){e.exports=i("P+m1")},"0S4P":function(t,i){t.exports=e},"P+m1":function(e,t,i){"use strict";i.r(t),i.d(t,"SheetModule",function(){return P});var n=i("vOrQ"),r=i("vG+p"),s=i("cfyg"),o=i("aP7H"),a=function(e){return e.title="title",e.top="top",e.left="left",e.data="data",e}({}),l=function(){function e(e,t,i){this.sectionId=e,this.renderer=t,this.parent=i,this.cells=[],this.lastUpdateData={},this.sectionIdRemapping={title:{cols:a.left,rows:a.top,width:a.left,height:a.top},top:{cols:a.top,rows:a.top,width:a.top,height:a.top},left:{cols:a.left,rows:a.left,width:a.left,height:a.left},data:{cols:a.top,rows:a.left,width:a.top,height:a.left}},this.baseCol=0,this.baseRow=0,this.cursorCol=2,this.cursorRow=2,this.border=this.renderer.createElement("div"),this.border.style.position="absolute",this.border.style.top="0",this.border.style.left="0",this.border.style.width="0",this.border.style.height="0",this.border.style.border="1px solid rgba(0,255,0,1)",this.border.style["pointer-events"]="none",this.border.style["z-index"]=100001,this.renderer.appendChild(this.parent,this.border),"data"===e&&(this.navigation=this.renderer.createElement("div"),this.navigation.style.position="absolute",this.navigation.style.top="0",this.navigation.style.left="0",this.navigation.style.width="0",this.navigation.style.height="0",this.navigation.style.border="2px solid rgba(255,0,0,1)",this.navigation.style["z-index"]=100002,this.renderer.appendChild(this.parent,this.navigation))}return e.prototype.update=function(e,t,i,n,r,s,o,l,h){void 0===s&&(s=1),void 0===o&&(o=5);var c=i[e].content,d=i[e].params,p=i[this.sectionIdRemapping[e].cols].cols,y=i[this.sectionIdRemapping[e].width].width,g=i[this.sectionIdRemapping[e].rows].rows,v=i[this.sectionIdRemapping[e].height].height;this.lastUpdateData.width=y,this.lastUpdateData.height=v;var m=l,x=h;e!==a.data&&e!==a.left||(x-=t.hscroll),e!==a.data&&e!==a.top||(m-=t.vscroll);for(var b,w=0,R=0;R<g;R++){this.cells[R]||(this.cells[R]=[]);var j=v[R],O=w;w+=j-s,b=0;for(var S=0;S<p;S++){var C=y[S],q=b,P=d[R][S];b+=C-s;var E=f(R,S,d,this.cells),M=void 0;if(E.r===R&&E.c===S){var V=this.cells[E.r][E.c];(M=(null==V?void 0:V.div)?V.div:this.renderer.createElement("div")).style.position="absolute",M.style.display="flex",M.style.border="1px solid rgba(0,0,0,0.5)",M.style.padding=o-1+"px",M.style.width=C+"px",M.style.height=j+"px",M.style.left=q+"px",M.style.top=O+"px",M.style.fontSize="10px",this.renderer.setProperty(M,"innerHTML",c[R][S]),this.renderer.appendChild(this.parent,M),u(M,P),P.s&&Object.assign(M.style,P.s)}else{var H=this.cells[E.r][E.c];H.div.style.width=-H.x+q+C+"px",H.div.style.height=-H.y+O+j+"px"}this.cells[R][S]={r:R,c:S,div:M,w:C,h:j,x:q,y:O,params:P,mergeBase:E}}}this.parent.style.position="absolute",this.parent.style.left=n+"px",this.parent.style.top=r+"px";var _=w+s;this.border.style.height=Math.min(_,x)+"px",_+r>x&&(_=Math.max(0,x-r)),"data"!==e&&"left"!==e||(_=Math.max(_,x-r)),this.parent.style.height=_+"px";var I=b+s;if(this.border.style.width=Math.min(I,m)+"px",I+n>m&&(I=Math.max(0,m-n)),"data"!==e&&"top"!==e||(I=Math.max(I,m-n)),this.parent.style.width=I+"px","data"===this.sectionId){this.navigation.style.height=v[this.cursorRow]+"px",this.navigation.style.width=y[this.cursorCol]+"px";for(var Q=-this.cursorRow,T=0;T<this.cursorRow;T++)Q+=v[T];var D=-this.cursorCol;for(T=0;T<this.cursorCol;T++)D+=y[T];this.navigation.style.top=Q+"px",this.navigation.style.left=D+"px"}return{calculatedH:_,calculatedW:I}},e}();function h(e,t){if(!e)return 0;for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return i;return 0}var c=["t","m","b"],d=["l","c","r"],p=["flex-start","center","flex-end"],u=function(e,t){var i=p[h(t.m,d)],n=p[h(t.m,c)];e.style["align-items"]=n,e.style["justify-content"]=i},f=function(e,t,i,n){var r,s,o=i[e][t];if(!o)return{r:e,c:t};if(null===(s=null===(r=n[e])||void 0===r?void 0:r[t])||void 0===s?void 0:s.mergeBase)return{r:n[e][t].mergeBase.r,c:n[e][t].mergeBase.c};var a=o.m.indexOf("L")>-1&&t>0,l=o.m.indexOf("U")>-1&&e>0;return a||l?a?f(e,t-1,i,n):f(e-1,l?t:t-1,i,n):{r:e,c:t}},y=i("YLtl"),g=i("Vgaj"),v=function(){function e(e,t){this.context=t,this.liveRequests=[],this.data$=new g.BehaviorSubject(Object(y.cloneDeep)(e))}return e.prototype.getData=function(e,t,i,n){var r=this,s=this.context.api.http.post(this.context.api.BASE_URL+"/sheet",{w:e,h:t,r:i,c:n,tabId:this.context.api.tabId,pageId:this.context.api.pageId}).subscribe(function(e){r.liveRequests.splice(r.liveRequests.indexOf(s),1),r.data$.next(e)},function(e){console.log(e)});this.liveRequests.push(s)},e.prototype.destroy=function(){this.liveRequests.forEach(function(e){return e.unsubscribe()})},e}(),m=function(){function e(){this.initialized=!1}return e.prototype.init=function(e){this.initialized||(console.log("TopRC",e.top.rows,e.top.cols),this.initialized=!0)},e.prototype.destroy=function(){},e}(),x=["sheetRef"],b=["sheetTitleRef"],w=["sheetTopRef"],R=["sheetLeftRef"],j=["sheetDataRef"],O=["sheetVScroll"],S=["sheetHScroll"],C=function(){function e(e,t,i,n,r){this.sanitizer=e,this.cd=t,this.context=i,this.renderer=n,this.el=r,this.sections={}}return e.prototype.onKeydownHandler=function(e){switch(console.log("onKeydownHandler"),e.key){case"ArrowDown":this.sections.data.cursorRow++,this.sections.data.navigation.style.height="100px",this.sections.data.navigation.style.width="100px",this.sections.data.navigation.style.top="10px",this.sections.data.navigation.style.left="10px",e.preventDefault();break;case"ArrowUp":this.sections.data.cursorRow--,e.preventDefault()}},e.prototype.ngOnInit=function(){var e=this;this.sanitizedVal=this.getSanitizedValue(),this.context.update$.pipe(Object(o.takeUntil)(this.context.destroy$)).subscribe(function(t){e.sanitizedVal=e.sanitizer.bypassSecurityTrustHtml(e.getSanitizedValue()),e.cd.detectChanges(),e.context.contentSizeChanged$.next()}),this.sections.title=new l(a.title,this.renderer,this.sheetTitleRef.nativeElement),this.sections.top=new l(a.top,this.renderer,this.sheetTopRef.nativeElement),this.sections.left=new l(a.left,this.renderer,this.sheetLeftRef.nativeElement),this.sections.data=new l(a.data,this.renderer,this.sheetDataRef.nativeElement);var t=this.context.pluginConfig.config;this.context.redraw$.pipe(Object(o.takeUntil)(this.context.destroy$),Object(o.take)(1)).subscribe(function(){e.sheetBuffer=new m,e.datasource=new v(t.data,e.context),e.datasource.data$.subscribe(function(t){t&&e.update(t)}),t.data||e.datasource.getData(e.context.wrapperComponentRef.location.nativeElement.offsetWidth,e.context.wrapperComponentRef.location.nativeElement.offsetHeight,0,0),delete t.data})},e.prototype.update=function(e){this.sheetBuffer.init(e);var t=this.context.wrapperComponentRef.location.nativeElement.offsetWidth,i=this.context.wrapperComponentRef.location.nativeElement.offsetHeight,n=this.context.pluginConfig.config,r=e.top.height.reduce(function(e,t){return e+t}),s=e.left.width.reduce(function(e,t){return e+t}),o=Object(y.isNil)(n.overlap)?1:n.overlap,l=Object(y.isNil)(n.cellPadding)?5:n.cellPadding,h=r-e.top.rows*o+n.hpad,c=s-e.left.cols*o+n.vpad;this.sections.title.update(a.title,n,e,0,0,o,l,t,i),this.sections.left.update(a.left,n,e,0,h,o,l,t,i),this.sections.top.update(a.top,n,e,c,0,o,l,t,i);var d=this.sections.data.update(a.data,n,e,c,h,o,l,t,i);this.sheetVScroll.nativeElement.style.position="absolute",this.sheetVScroll.nativeElement.style.top=h+"px",this.sheetVScroll.nativeElement.style.right="0px",this.sheetVScroll.nativeElement.style.width=n.vscroll+"px",this.sheetVScroll.nativeElement.style.height=d.calculatedH+"px",this.sheetHScroll.nativeElement.style.position="absolute",this.sheetHScroll.nativeElement.style.left=c+"px",this.sheetHScroll.nativeElement.style.bottom="0px",this.sheetHScroll.nativeElement.style.height=n.hscroll+"px",this.sheetHScroll.nativeElement.style.width=d.calculatedW+"px"},e.prototype.getSanitizedValue=function(){return this.escapeHtml(this.prettyStringify(this.context.pluginConfig.config.data,0))},e.prototype.prettyStringify=function(e,t){var i=this.getObjectType(e);if(0===i)return JSON.stringify(e);var n=[];if(1===i){for(var r=0,s=e;r<s.length;r++)n.push(this.prettyStringify(s[r],t+2));return"["+n.join(", ")+"]"}for(var o=" ".repeat(t),a="  "+o,l=0,h=Object.keys(e).sort();l<h.length;l++){var c=h[l];n.push(a+'"'+c+'": '+this.prettyStringify(e[c],t+2))}return 0===n.length?"{}":"{\n"+n.join(",\n")+"\n"+o+"}"},e.prototype.getObjectType=function(e){return"object"==typeof e?Array.isArray(e)?1:2:0},e.prototype.escapeHtml=function(e){return null==e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e.prototype.ngOnDestroy=function(){var e,t;null===(e=this.datasource)||void 0===e||e.destroy(),null===(t=this.sheetBuffer)||void 0===t||t.destroy()},e.\u0275fac=function(t){return new(t||e)(n["\u0275\u0275directiveInject"](r.DomSanitizer),n["\u0275\u0275directiveInject"](n.ChangeDetectorRef),n["\u0275\u0275directiveInject"](s.PLUGIN_CONTEXT),n["\u0275\u0275directiveInject"](n.Renderer2),n["\u0275\u0275directiveInject"](n.ElementRef))},e.\u0275cmp=n["\u0275\u0275defineComponent"]({type:e,selectors:[["app-sheet"]],viewQuery:function(e,t){if(1&e&&(n["\u0275\u0275staticViewQuery"](x,!0),n["\u0275\u0275staticViewQuery"](b,!0),n["\u0275\u0275staticViewQuery"](w,!0),n["\u0275\u0275staticViewQuery"](R,!0),n["\u0275\u0275staticViewQuery"](j,!0),n["\u0275\u0275staticViewQuery"](O,!0),n["\u0275\u0275staticViewQuery"](S,!0)),2&e){var i=void 0;n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetRef=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetTitleRef=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetTopRef=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetLeftRef=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetDataRef=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetVScroll=i.first),n["\u0275\u0275queryRefresh"](i=n["\u0275\u0275loadQuery"]())&&(t.sheetHScroll=i.first)}},hostBindings:function(e,t){1&e&&n["\u0275\u0275listener"]("keydown",function(e){return t.onKeydownHandler(e)})},decls:14,vars:0,consts:[["tabindex","0",1,"app-sheet"],["sheetRef",""],[1,"app-sheet-section"],["sheetTitleRef",""],["sheetTopRef",""],["sheetLeftRef",""],["sheetDataRef",""],[1,"scroll","hscroll"],["sheetHScroll",""],[1,"scroll","vscroll"],["sheetVScroll",""]],template:function(e,t){1&e&&(n["\u0275\u0275elementStart"](0,"div",0,1),n["\u0275\u0275element"](2,"div",2,3),n["\u0275\u0275element"](4,"div",2,4),n["\u0275\u0275element"](6,"div",2,5),n["\u0275\u0275element"](8,"div",2,6),n["\u0275\u0275element"](10,"div",7,8),n["\u0275\u0275element"](12,"div",9,10),n["\u0275\u0275elementEnd"]())},styles:["[_nghost-%COMP%]{width:100%;height:100%;overflow:hidden;display:block;position:relative}[_nghost-%COMP%]   .app-sheet[_ngcontent-%COMP%]{width:100%;height:100%;display:table}[_nghost-%COMP%]   .app-sheet[_ngcontent-%COMP%]   .hscroll[_ngcontent-%COMP%]{background:rgba(0,255,0,.5);outline:1px solid rgba(0,255,0,.9);outline-offset:-1px}[_nghost-%COMP%]   .app-sheet[_ngcontent-%COMP%]   .vscroll[_ngcontent-%COMP%]{background:rgba(0,0,255,.5);outline:1px solid rgba(0,0,255,.9);outline-offset:-1px}[_nghost-%COMP%]   .app-sheet[_ngcontent-%COMP%]   .app-sheet-section[_ngcontent-%COMP%]{overflow:hidden;background:rgba(0,0,0,.1)}"]}),e}(),q=i("0S4P"),P=function(){function e(){}return e.entry=C,e.\u0275mod=n["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=n["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[q.CommonModule]]}),e}();t.default=P},Vgaj:function(e,i){e.exports=t},YLtl:function(e,t){e.exports=i},aP7H:function(e,t){e.exports=n},cfyg:function(e,t){e.exports=r},"vG+p":function(e,t){e.exports=s},vOrQ:function(e,t){e.exports=o}})});